;────────────────────────────────────
;愛撫、性交等の継続、解除、処理
;────────────────────────────────────
@SHOW_TOUCH
FOR LOCAL,1,CHARANUM
	SIF TARGET:LOCAL <= 0
		CONTINUE
	SELECTCASE TEQUIP:(TARGET:LOCAL):101
		CASE 3
			PRINT 手淫する 
		CASE 4
			PRINT フェラする 
		CASE 6
			PRINT 逆レイプ 
		CASE 7
			PRINT 逆アナル 
		CASE 8
			PRINT 足コキする 
	ENDSELECT
	SELECTCASE TEQUIP:(TARGET:LOCAL):102
		CASE 1
			PRINT 素股 
		CASE 3
			PRINT クリ愛撫 
		CASE 4
			PRINT クンニ 
	ENDSELECT
	SELECTCASE TEQUIP:(TARGET:LOCAL):103
		CASE 1
			PRINT 手淫 
		CASE 5
			PRINT 胸揉みあい 
	ENDSELECT
	SELECTCASE TEQUIP:(TARGET:LOCAL):104
		CASE 1
			PRINT フェラ 
		CASE 2
			PRINT クンニさせる 
		CASE 4
			PRINT キス 
		CASE 7
			PRINT アナル奉仕 
	ENDSELECT
	SELECTCASE TEQUIP:(TARGET:LOCAL):105
		CASE 1
			PRINT パイズリ 
		CASE 3
			PRINT 胸愛撫 
	ENDSELECT
	SELECTCASE TEQUIP:(TARGET:LOCAL):106
		CASE 1
			PRINT 性交 
		CASE 3
			PRINT 指入れ 
	ENDSELECT
	SELECTCASE TEQUIP:(TARGET:LOCAL):107
		CASE 1
			PRINT アナルセックス 
		CASE 3
			PRINT アナル愛撫 
		CASE 4
			PRINT アナル舐め 
	ENDSELECT
	SELECTCASE TEQUIP:(TARGET:LOCAL):108
		CASE 1
			PRINT 足コキ 
	ENDSELECT
	PRINTFORML (%CALLNAME:(TARGET:LOCAL)%)
NEXT
PRINTL 
@TOUCH_SUCCESSION(ARG)
VARSET LOCAL
SELECTCASE SELECTCOM
	;愛撫
	CASE 0
		CALL TOUCH_RESET_M(3)
		CALL TOUCH_RESET_M(4)
	;クンニ
	CASE 1
		;性交解除
		SIF TEQUIP:ARG:膣 == 1
			TEQUIP:ARG:膣 = 0
		SIF TEQUIP:ARG:アナル == 1
			TEQUIP:ARG:アナル = 0
		CALL TOUCH_SET(102,4,ARG)
	;フェラする
	CASE 2
		;性交解除
		SIF TEQUIP:ARG:膣 == 1
			TEQUIP:ARG:膣 = 0
		SIF TEQUIP:ARG:アナル == 1
			TEQUIP:ARG:アナル = 0
		CALL TOUCH_SET(101,4,ARG)
	;指挿れ
	CASE 3
		IF TEQUIP:ARG:バイブ
			CALL TOUCH_RESET_M(3)
		ELSE
			CALL TOUCH_SET(106,3,ARG)
		ENDIF
	;アナル舐め
	CASE 4
		;性交解除
		SIF TEQUIP:ARG:膣 == 1
			TEQUIP:ARG:膣 = 0
		SIF TEQUIP:ARG:アナル == 1
			TEQUIP:ARG:アナル = 0
		CALL TOUCH_SET(107,4,ARG)
	;アナル愛撫
	CASE 5
		IF TEQUIP:ARG:アナルバイブ || TEQUIP:ARG:アナルビーズ || TEQUIP:ARG:浣腸
			CALL TOUCH_RESET_M(3)
		ELSE
			CALL TOUCH_SET(107,3,ARG)
		ENDIF
	;胸愛撫
	CASE 6
		CALL TOUCH_SET(105,3,ARG)
	;乳首責め
	CASE 7
		CALL TOUCH_SET(105,3,ARG)
	;秘貝開帳
	CASE 8
		CALL TOUCH_RESET_T(ARG)
	;自慰
	CASE 9
	;乳首吸い
	CASE 10
		CALL TOUCH_SET(105,4,ARG)
	;キスする
	CASE 20
		CALL TOUCH_SET(104,4,ARG)
	;ローター
	CASE 40
		CALL TOUCH_RESET_M(3)
		TEQUIP:ARG:クリトリス = 0
		TEQUIP:ARG:ペニス = 0
	;Ｅマッサージャ
	CASE 41
		CALL TOUCH_SET(0,0,0,1)
		TEQUIP:ARG:クリトリス = 0
		TEQUIP:ARG:ペニス = 0
	;クリキャップ
	CASE 42
		CALL TOUCH_RESET_M(3)
		TEQUIP:ARG:クリトリス = 0
		TEQUIP:ARG:ペニス = 0
	;オナホール
	CASE 43
		CALL TOUCH_RESET_M(3)
		TEQUIP:ARG:クリトリス = 0
		TEQUIP:ARG:ペニス = 0
	;バイブ
	CASE 44
		CALL TOUCH_RESET_M(3)
		TEQUIP:ARG:膣 = 0
	;アナルバイブ
	CASE 45
		CALL TOUCH_RESET_M(3)
		TEQUIP:ARG:アナル = 0
	;アナルビーズ
	CASE 46
		CALL TOUCH_RESET_M(3)
		TEQUIP:ARG:アナル = 0
	;ニプルキャップ
	CASE 46
		CALL TOUCH_RESET_M(3)
		TEQUIP:ARG:胸 = 0
	;正常位
	CASE 60
		CALL TOUCH_SET(106,1,ARG,1)
		TEQUIP:ARG:体位 = 1
	;後背位
	CASE 61
		CALL TOUCH_SET(106,1,ARG,1)
		TEQUIP:ARG:体位 = 2
	;正常位アナル
	CASE 62
		CALL TOUCH_SET(107,1,ARG,1)
		TEQUIP:ARG:体位 = 1
	;後背位アナル
	CASE 63
		CALL TOUCH_SET(107,1,ARG,1)
		TEQUIP:ARG:体位 = 2
	;逆レイプ
	CASE 64
		CALL TOUCH_SET(101,6,ARG,1)
		TEQUIP:ARG:体位 = 3
	;騎乗位
	CASE 65
		CALL TOUCH_SET(106,1,ARG,1)
		TEQUIP:ARG:体位 = 3
	;騎乗位アナル
	CASE 66
		CALL TOUCH_SET(107,1,ARG,1)
		TEQUIP:ARG:体位 = 3
	;対面座位
	CASE 67
		CALL TOUCH_SET(106,1,ARG,1)
		TEQUIP:ARG:体位 = 4
	;背面座位
	CASE 68
		CALL TOUCH_SET(106,1,ARG,1)
		TEQUIP:ARG:体位 = 5
	;対面座位アナル
	CASE 69
		CALL TOUCH_SET(107,1,ARG,1)
		TEQUIP:ARG:体位 = 4
	;背面座位アナル
	CASE 70
		CALL TOUCH_SET(107,1,ARG,1)
		TEQUIP:ARG:体位 = 5
	;二穴
	CASE 71
		IF TEQUIP:ARG:膣 == 1
			TEQUIP:ARG:アナル = 0
		ELSEIF TEQUIP:ARG:アナル == 1
			TEQUIP:ARG:膣 = 0
		ENDIF
	;二穴される
	CASE 72
		IF TEQUIP:MASTER:膣 == 1
			TEQUIP:MASTER:アナル = 0
		ELSEIF TEQUIP:MASTER:アナル == 1
			TEQUIP:MASTER:膣 = 0
		ENDIF
	;手淫
	CASE 80
		CALL TOUCH_SET(103,1,ARG)
	;フェラチオ
	CASE 81
		CALL TOUCH_SET(104,1,ARG)
	;パイズリ
	CASE 82
		CALL TOUCH_SET(105,1,ARG)
	;素股
	CASE 83
		CALL TOUCH_SET(102,1,ARG)
	;泡踊り
	CASE 84
		CALL TOUCH_SET(0,0,0,1)
	;Ａ正常位される
	CASE 92
		CALL TOUCH_SET(101,7,ARG,1)
		TEQUIP:PLAYER:体位 = 1
	;Ａ後背位される
	CASE 93
		CALL TOUCH_SET(101,7,ARG,1)
		TEQUIP:PLAYER:体位 = 2
	;Ａ騎乗位する
	CASE 94
		CALL TOUCH_SET(101,7,ARG,1)
		TEQUIP:PLAYER:体位 = 3
	;クンニされる
	CASE 96
		CALL TOUCH_SET(104,2,ARG)
	;正常位させる
	CASE 97
		CALL TOUCH_SET(101,6,ARG,1)
		TEQUIP:ARG:体位 = 1
	;後背位させる
	CASE 98
		CALL TOUCH_SET(101,6,ARG,1)
		TEQUIP:ARG:体位 = 2
	;騎乗位する
	CASE 99
		CALL TOUCH_SET(101,6,ARG,1)
		TEQUIP:ARG:体位 = 3
	;スパンキング
	CASE 100
		CALL TOUCH_RESET_M(3)
	;クンニ強制
	CASE 120
		CALL TOUCH_SET(104,2,ARG)
	;乳の揉み合い
	CASE 126
		CALL TOUCH_RESET_M(3)
		TEQUIP:ARG:指 = 0
		CALL TOUCH_SET(105,3,ARG)
		CALL TOUCH_SET(103,5,ARG)
	CASE IS < 200
		CALL TOUCH_SET(0,0,0,1)
	CASE IS > 500
		CALL TOUCH_SET(0,0,0,1)
ENDSELECT


;MASTERとTARGETの接触部位を設定する
@TOUCH_SET(ARG,ARG:1,ARG:2,ARG:3)
;ARG TARGETの接触部位(101=ペニス 102=クリトリス 103=指 104=口 105=胸 106=膣 107=アナル)
;ARG:1 MASTERの接触部位(1=ペニス 2=クリトリス 3=指 4=口 5=胸 6=膣 7=アナル)
;ARG:2 対象のキャラ番号
;ARG:3 真ならリセットする
VARSET LOCAL

IF ARG:3
	FOR LOCAL,1,CHARANUM
		FOR LOCAL:1,1,8
			TEQUIP:LOCAL:(100 + LOCAL:1) = 0
		NEXT
		;ついでに体位もリセット
		TEQUIP:LOCAL:体位 = 0
	NEXT
ENDIF
SIF ARG <= 100
	RETURN 0
FOR LOCAL,1,CHARANUM
	FOR LOCAL:1,1,8
		SIF TEQUIP:LOCAL:(100 + LOCAL:1) == ARG:1
			TEQUIP:LOCAL:(100 + LOCAL:1) = 0
	NEXT
NEXT
TEQUIP:(ARG:2):ARG = ARG:1

;MASTERの接触部位をリセットする
@TOUCH_RESET_M(ARG)
;ARG:1 MASTERの接触部位(1=ペニス 2=クリトリス 3=指 4=口 5=胸 6=膣 7=アナル)

FOR LOCAL,1,CHARANUM
	SIF TARGET:LOCAL <= 0
		CONTINUE
	FOR LOCAL:1,1,8
		SIF TEQUIP:(TARGET:LOCAL):(100 + LOCAL:1) == ARG
				TEQUIP:(TARGET:LOCAL):(100 + LOCAL:1) = 0
	NEXT
NEXT

;TARGETの接触部位をリセットする
@TOUCH_RESET_T(ARG)
FOR LOCAL,1,8
	TEQUIP:ARG:(100 + LOCAL) = 0
NEXT

@MASTER_POSE(ARG,ARG:1,ARG:2)
;ARG MASTERの部位を占有中のTARGET:Xの部位(1=ペニス 2=クリトリス 3=指 4=口 5=胸 6=膣 7=アナル)
;ARG 0なら誰が占有しているか返す
;ARG:1 MASTERの部位(1=ペニス 2=クリトリス 3=指 4=口 5=胸 6=膣 7=アナル)
;ARG:2 真なら前ターンの履歴を見る
;戻り値 MASTERの部位を占有中のTARGET:Xがいるならそのキャラ番号を返す
;MASTER_POSE(4,1,1)なら前ターン(第3引数)に誰かがMASTERのペニス(第2引数)を口(第1引数)で占有していた場合、そのキャラ番号を返す
#FUNCTION
VARSET LOCAL
IF !ARG
	FOR LOCAL,1,CHARANUM
		FOR LOCAL:1,1,8
			SIF TEQUIP:ARG:(100 + LOCAL) == ARG:1
				RETURNF LOCAL
		NEXT
	NEXT
ENDIF
ARG:2 = ARG:2 ? 1 # 0
FOR LOCAL,1,CHARANUM
	SIF TARGET:LOCAL <= 0
		CONTINUE
	SIF TEQUIP:(TARGET:LOCAL):(100 + ARG + 10 * ARG:2) == ARG:1
		RETURNF TARGET:LOCAL
NEXT


