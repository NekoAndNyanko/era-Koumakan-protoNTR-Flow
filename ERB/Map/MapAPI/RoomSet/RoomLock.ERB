;-------------------------------------------------------------------------------
;指定の部屋に鍵を掛けられるかどうかを判定します
@isLockable(奴隷, 部屋番号)
#FUNCTION
#DIM 奴隷     ;鍵を掛けようとするキャラクター
#DIM 部屋番号 ;鍵を掛けられる部屋

IF 部屋番号 == GET_PRIVATE_ROOM(奴隷, 0)
	RETURNF 1
ENDIF

IF 部屋番号 != CFLAG:奴隷:当前位置
	RETURNF 0
ENDIF

SELECTCASE 部屋番号
	CASE 位置_红魔馆_仓库
		RETURNF 1
	CASE 位置_红魔馆_屋外厕所
		RETURNF 1
	CASEELSE
		RETURNF 0
ENDSELECT
RETURNF 0

;-------------------------------------------------------------------------------
;指定の部屋に鍵が掛かっているかどうかを判定します。
@isLocked(部屋番号)
#FUNCTION
#DIM 部屋番号 ;鍵を掛けられる部屋
RETURNF ( FLAG:(300 + 部屋番号) > 0 )

;-------------------------------------------------------------------------------
;指定の部屋の扉を開けられるかどうかを判定します。
@canOpenDoor(奴隷, 部屋番号)
#FUNCTION
#DIM 奴隷     ;鍵を開けようとするキャラクター
#DIM 部屋番号 ;鍵を開けられる部屋
IF !isLocked(部屋番号)
	RETURNF 1
ENDIF
RETURNF 0

;-------------------------------------------------------------------------------
;指定の部屋を解錠できるかどうかを判定します。
@canUnLock(奴隷, 部屋番号)
#FUNCTION
#DIM 奴隷     ;鍵を開けようとするキャラクター
#DIM 部屋番号 ;鍵を開けられる部屋

IF isLockedByBolt(部屋番号)
	;閂での施錠の場合
	IF CFLAG:奴隷:当前位置 == 部屋番号
		;内側からなら解錠出来る
		RETURNF 1
	ENDIF
	IF GET_PRIVATE_ROOM(奴隷, 0) == 部屋番号
		;自室なら外からでも解錠出来る（救済措置）
		RETURNF 1
	ENDIF
	RETURNF 0
ENDIF

;閉められるなら開けられる
IF isLockable(奴隷, 部屋番号)
	RETURNF 1
ENDIF

IF 奴隷 == MASTER
	; あなた が鍵を持っているなら開けられる
	IF HAS_DUPLICATE_KEY(部屋番号)
		RETURNF 1
	ENDIF
ENDIF

RETURNF 0

;-------------------------------------------------------------------------------
;指定の部屋を施錠します
@tryLock(奴隷, 部屋番号)
#FUNCTION
#DIM 奴隷     ;鍵を掛けようとするキャラクター
#DIM 部屋番号 ;鍵を掛けられる部屋

IF !isLockable(奴隷, 部屋番号)
	RETURNF 0
ENDIF

FLAG:(300 + 部屋番号) = 1

RETURNF 1

;-------------------------------------------------------------------------------
;部屋が閂で施錠されているかどうかを判定します。
@isLockedByBolt(部屋番号)
#FUNCTION
#DIM 部屋番号 ;鍵を掛けられる部屋
RETURNF ( FLAG:(300 + 部屋番号) > 1 )

;-------------------------------------------------------------------------------
;指定の部屋を閂で施錠します。自室を内側からでなければ施錠できず、合鍵では開けなくなります。
@tryLockBolt(奴隷, 部屋番号)
#FUNCTION
#DIM 奴隷     ;鍵を掛けようとするキャラクター
#DIM 部屋番号 ;鍵を掛けられる部屋

IF GET_PRIVATE_ROOM(奴隷, 0) != CFLAG:奴隷:当前位置
	RETURNF 0
ENDIF
IF 部屋番号 != CFLAG:奴隷:当前位置
	RETURNF 0
ENDIF

FLAG:(300 + 部屋番号) = 2

RETURNF 1

;-------------------------------------------------------------------------------
;指定の部屋を解錠します
@tryUnLock(奴隷, 部屋番号)
#FUNCTION
#DIM 奴隷     ;鍵を掛けようとするキャラクター
#DIM 部屋番号 ;鍵を掛けられる部屋

IF !canUnLock(奴隷, 部屋番号)
	RETURNF 0
ENDIF

FLAG:(300 + 部屋番号) = 0

RETURNF 1

;-------------------------------------------------------------------------------
;指定の部屋の扉を開けます
@tryOpenDoor(奴隷, 部屋番号)
#FUNCTION
#DIM 奴隷     ;鍵を開けようとするキャラクター
#DIM 部屋番号 ;鍵を開けられる部屋

IF !canOpenDoor(奴隷, 部屋番号)
	RETURNF 0
ENDIF

RETURNF 1

