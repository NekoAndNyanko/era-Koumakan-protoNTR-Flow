;────────────────────────────────────
;爱抚、性交等の継続、解除、処理
;────────────────────────────────────
@SHOW_TOUCH
FOR LOCAL,1,CHARANUM
	SIF TARGET:LOCAL <= 0
		CONTINUE
	SELECTCASE TEQUIP:(TARGET:LOCAL):101
		CASE 3
			PRINT 手淫する 
		CASE 4
			PRINT 调教者口交 
		CASE 6
			PRINT 逆强奸 
		CASE 7
			PRINT 逆菊花 
		CASE 8
			PRINT 调教者足交 
	ENDSELECT
	SELECTCASE TEQUIP:(TARGET:LOCAL):102
		CASE 1
			PRINT 素股 
		CASE 3
			PRINT 阴蒂爱抚 
		CASE 4
			PRINT 舔阴 
	ENDSELECT
	SELECTCASE TEQUIP:(TARGET:LOCAL):103
		CASE 1
			PRINT 手淫 
		CASE 5
			PRINT 胸揉みあい 
	ENDSELECT
	SELECTCASE TEQUIP:(TARGET:LOCAL):104
		CASE 1
			PRINT フェラ 
		CASE 2
			PRINT 舔阴させる 
		CASE 4
			PRINT キス 
		CASE 7
			PRINT 舔肛侍奉 
	ENDSELECT
	SELECTCASE TEQUIP:(TARGET:LOCAL):105
		CASE 1
			PRINT 乳交 
		CASE 3
			PRINT 胸爱抚 
	ENDSELECT
	SELECTCASE TEQUIP:(TARGET:LOCAL):106
		CASE 1
			PRINT 性交 
		CASE 3
			PRINT 指入れ 
	ENDSELECT
	SELECTCASE TEQUIP:(TARGET:LOCAL):107
		CASE 1
			PRINT 菊花セックス 
		CASE 3
			PRINT 肛门爱抚 
		CASE 4
			PRINT 舔舐肛门 
	ENDSELECT
	SELECTCASE TEQUIP:(TARGET:LOCAL):108
		CASE 1
			PRINT 足交 
	ENDSELECT
	PRINTFORML (%CALLNAME:(TARGET:LOCAL)%)
NEXT
PRINTL 
@TOUCH_SUCCESSION(ARG)
VARSET LOCAL
SELECTCASE SELECTCOM
		;爱抚
	CASE 0
		CALL TOUCH_RESET_M(3)
		CALL TOUCH_RESET_M(4)
		;舔阴
	CASE 1
		;性交解除
		SIF TEQUIP:ARG:膣 == 1
			TEQUIP:ARG:膣 = 0
		SIF TEQUIP:ARG:菊花 == 1
			TEQUIP:ARG:菊花 = 0
		CALL TOUCH_SET(102,4,ARG)
		;调教者口交
	CASE 2
		;性交解除
		SIF TEQUIP:ARG:膣 == 1
			TEQUIP:ARG:膣 = 0
		SIF TEQUIP:ARG:菊花 == 1
			TEQUIP:ARG:菊花 = 0
		CALL TOUCH_SET(101,4,ARG)
		;手指插入
	CASE 3
		IF TEQUIP:ARG:振动棒
			CALL TOUCH_RESET_M(3)
		ELSE
			CALL TOUCH_SET(106,3,ARG)
		ENDIF
		;舔舐肛门
	CASE 4
		;性交解除
		SIF TEQUIP:ARG:膣 == 1
			TEQUIP:ARG:膣 = 0
		SIF TEQUIP:ARG:菊花 == 1
			TEQUIP:ARG:菊花 = 0
		CALL TOUCH_SET(107,4,ARG)
		;肛门爱抚
	CASE 5
		IF TEQUIP:ARG:肛门振动棒 || TEQUIP:ARG:肛珠 || TEQUIP:ARG:灌肠
			CALL TOUCH_RESET_M(3)
		ELSE
			CALL TOUCH_SET(107,3,ARG)
		ENDIF
		;胸爱抚
	CASE 6
		CALL TOUCH_SET(105,3,ARG)
		;玩弄乳首
	CASE 7
		CALL TOUCH_SET(105,3,ARG)
		;掰开小穴
	CASE 8
		CALL TOUCH_RESET_T(ARG)
		;自慰
	CASE 9
		;吮吸乳首
	CASE 10
		CALL TOUCH_SET(105,4,ARG)
		;接吻
	CASE 20
		CALL TOUCH_SET(104,4,ARG)
		;跳蛋
	CASE 40
		CALL TOUCH_RESET_M(3)
		TEQUIP:ARG:阴蒂 = 0
		TEQUIP:ARG:阴茎 = 0
		;E按摩棒
	CASE 41
		CALL TOUCH_SET(0,0,0,1)
		TEQUIP:ARG:阴蒂 = 0
		TEQUIP:ARG:阴茎 = 0
		;阴蒂夹
	CASE 42
		CALL TOUCH_RESET_M(3)
		TEQUIP:ARG:阴蒂 = 0
		TEQUIP:ARG:阴茎 = 0
		;飞机杯
	CASE 43
		CALL TOUCH_RESET_M(3)
		TEQUIP:ARG:阴蒂 = 0
		TEQUIP:ARG:阴茎 = 0
		;振动棒
	CASE 44
		CALL TOUCH_RESET_M(3)
		TEQUIP:ARG:膣 = 0
		;肛门振动棒
	CASE 45
		CALL TOUCH_RESET_M(3)
		TEQUIP:ARG:菊花 = 0
		;肛珠
	CASE 46
		CALL TOUCH_RESET_M(3)
		TEQUIP:ARG:菊花 = 0
		;乳头夹
	CASE 46
		CALL TOUCH_RESET_M(3)
		TEQUIP:ARG:胸 = 0
		;正常位
	CASE 60
		CALL TOUCH_SET(106,1,ARG,1)
		TEQUIP:ARG:体位 = 1
		;后背位
	CASE 61
		CALL TOUCH_SET(106,1,ARG,1)
		TEQUIP:ARG:体位 = 2
		;肛交正常位
	CASE 62
		CALL TOUCH_SET(107,1,ARG,1)
		TEQUIP:ARG:体位 = 1
		;肛交后背位
	CASE 63
		CALL TOUCH_SET(107,1,ARG,1)
		TEQUIP:ARG:体位 = 2
		;逆强奸
	CASE 64
		CALL TOUCH_SET(101,6,ARG,1)
		TEQUIP:ARG:体位 = 3
		;骑乘位
	CASE 65
		CALL TOUCH_SET(106,1,ARG,1)
		TEQUIP:ARG:体位 = 3
		;肛交骑乘位
	CASE 66
		CALL TOUCH_SET(107,1,ARG,1)
		TEQUIP:ARG:体位 = 3
		;対面座位
	CASE 67
		CALL TOUCH_SET(106,1,ARG,1)
		TEQUIP:ARG:体位 = 4
		;背面座位
	CASE 68
		CALL TOUCH_SET(106,1,ARG,1)
		TEQUIP:ARG:体位 = 5
		;肛交对面座位
	CASE 69
		CALL TOUCH_SET(107,1,ARG,1)
		TEQUIP:ARG:体位 = 4
		;肛交背面座位
	CASE 70
		CALL TOUCH_SET(107,1,ARG,1)
		TEQUIP:ARG:体位 = 5
		;二穴
	CASE 71
		IF TEQUIP:ARG:膣 == 1
			TEQUIP:ARG:菊花 = 0
		ELSEIF TEQUIP:ARG:菊花 == 1
			TEQUIP:ARG:膣 = 0
		ENDIF
		;二穴される
	CASE 72
		IF TEQUIP:MASTER:膣 == 1
			TEQUIP:MASTER:菊花 = 0
		ELSEIF TEQUIP:MASTER:菊花 == 1
			TEQUIP:MASTER:膣 = 0
		ENDIF
		;手淫
	CASE 80
		CALL TOUCH_SET(103,1,ARG)
		;口交
	CASE 81
		CALL TOUCH_SET(104,1,ARG)
		;乳交
	CASE 82
		CALL TOUCH_SET(105,1,ARG)
		;素股
	CASE 83
		CALL TOUCH_SET(102,1,ARG)
		;泡澡
	CASE 84
		CALL TOUCH_SET(0,0,0,1)
		;Ａ正常位侍奉
	CASE 92
		CALL TOUCH_SET(101,7,ARG,1)
		TEQUIP:PLAYER:体位 = 1
		;Ａ后背位侍奉
	CASE 93
		CALL TOUCH_SET(101,7,ARG,1)
		TEQUIP:PLAYER:体位 = 2
		;Ａ骑乘位侍奉
	CASE 94
		CALL TOUCH_SET(101,7,ARG,1)
		TEQUIP:PLAYER:体位 = 3
		;舔阴侍奉
	CASE 96
		CALL TOUCH_SET(104,2,ARG)
		;正常位させる
	CASE 97
		CALL TOUCH_SET(101,6,ARG,1)
		TEQUIP:ARG:体位 = 1
		;后背位させる
	CASE 98
		CALL TOUCH_SET(101,6,ARG,1)
		TEQUIP:ARG:体位 = 2
		;骑乘位侍奉
	CASE 99
		CALL TOUCH_SET(101,6,ARG,1)
		TEQUIP:ARG:体位 = 3
		;打屁股
	CASE 100
		CALL TOUCH_RESET_M(3)
		;强制舔阴
	CASE 120
		CALL TOUCH_SET(104,2,ARG)
		;乳房相互摩擦
	CASE 126
		CALL TOUCH_RESET_M(3)
		TEQUIP:ARG:指 = 0
		CALL TOUCH_SET(105,3,ARG)
		CALL TOUCH_SET(103,5,ARG)
	CASE IS < 200
		CALL TOUCH_SET(0,0,0,1)
	CASE IS > 500
		CALL TOUCH_SET(0,0,0,1)
ENDSELECT


;MASTERとTARGETの接触部位を設定する
@TOUCH_SET(ARG,ARG:1,ARG:2,ARG:3)
;ARG TARGETの接触部位(101=阴茎 102=阴蒂 103=指 104=口 105=胸 106=膣 107=菊花)
;ARG:1 MASTERの接触部位(1=阴茎 2=阴蒂 3=指 4=口 5=胸 6=膣 7=菊花)
;ARG:2 対象のキャラ番号
;ARG:3 真ならリセットする
VARSET LOCAL

IF ARG:3
	FOR LOCAL,1,CHARANUM
		FOR LOCAL:1,1,8
			TEQUIP:LOCAL:(100 + LOCAL:1) = 0
		NEXT
		;ついでに体位もリセット
		TEQUIP:LOCAL:体位 = 0
	NEXT
ENDIF
SIF ARG <= 100
	RETURN 0
FOR LOCAL,1,CHARANUM
	FOR LOCAL:1,1,8
		SIF TEQUIP:LOCAL:(100 + LOCAL:1) == ARG:1
			TEQUIP:LOCAL:(100 + LOCAL:1) = 0
	NEXT
NEXT
TEQUIP:(ARG:2):ARG = ARG:1

;MASTERの接触部位をリセットする
@TOUCH_RESET_M(ARG)
;ARG:1 MASTERの接触部位(1=阴茎 2=阴蒂 3=指 4=口 5=胸 6=膣 7=菊花)

FOR LOCAL,1,CHARANUM
	SIF TARGET:LOCAL <= 0
		CONTINUE
	FOR LOCAL:1,1,8
		SIF TEQUIP:(TARGET:LOCAL):(100 + LOCAL:1) == ARG
			TEQUIP:(TARGET:LOCAL):(100 + LOCAL:1) = 0
	NEXT
NEXT

;TARGETの接触部位をリセットする
@TOUCH_RESET_T(ARG)
FOR LOCAL,1,8
	TEQUIP:ARG:(100 + LOCAL) = 0
NEXT

@MASTER_POSE(ARG,ARG:1,ARG:2)
;ARG MASTERの部位を占有中のTARGET:Xの部位(1=阴茎 2=阴蒂 3=指 4=口 5=胸 6=膣 7=菊花)
;ARG 0なら誰が占有しているか返す
;ARG:1 MASTERの部位(1=阴茎 2=阴蒂 3=指 4=口 5=胸 6=膣 7=菊花)
;ARG:2 真なら前ターンの履歴を見る
;戻り値 MASTERの部位を占有中のTARGET:Xがいるならそのキャラ番号を返す
;MASTER_POSE(4,1,1)なら前ターン(第3引数)に誰かがMASTERの阴茎(第2引数)を口(第1引数)で占有していた場合、そのキャラ番号を返す
#FUNCTION
VARSET LOCAL
IF !ARG
	FOR LOCAL,1,CHARANUM
		FOR LOCAL:1,1,8
			SIF TEQUIP:ARG:(100 + LOCAL) == ARG:1
				RETURNF LOCAL
		NEXT
	NEXT
ENDIF
ARG:2 = ARG:2 ? 1 # 0
FOR LOCAL,1,CHARANUM
	SIF TARGET:LOCAL <= 0
		CONTINUE
	SIF TEQUIP:(TARGET:LOCAL):(100 + ARG + 10 * ARG:2) == ARG:1
		RETURNF TARGET:LOCAL
NEXT


