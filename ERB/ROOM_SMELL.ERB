;----------------------------------------------------------------------------------------
;
;部屋のにおいパッチ
;
;----------------------------------------------------------------------------------------

;起床時の処理
@ROOM_SMELL
;各キャラの初期体臭(毎日1.5倍・阴茎持ちはさらに1.5倍)
LOCAL:3 = 1
;においが消えていく頻度(高くするとすぐに換気されます)
LOCAL:4 = 60
;消臭量
LOCAL:5 = 10

SIF !FLAG:(部屋のにおい_初期FLAG)
	RETURN 0

;起床時間と現在時刻が一致する場合, 朝の処理
IF CFLAG:MASTER:312 == TIME
	CALL ROOM_SMELL_MORNING(部屋のにおい_初期FLAG,部屋のにおい_初期FLAG_2,角色的气味_初期CFLAG,LOCAL:3)
	;一定時間ごとににおいが換気されていく処理
ELSEIF TIME - FLAG:(LOCAL:1) > LOCAL:4
	CALL ROOM_SMELL_VENTILATION(部屋のにおい_初期FLAG,部屋のにおい_初期FLAG_2,角色的气味_初期CFLAG,LOCAL:5)
ENDIF

;日中の処理
CALL ROOM_SMELL_DAY(部屋のにおい_初期FLAG,部屋のにおい_初期FLAG_2,角色的气味_初期CFLAG)

RETURN 0


;起床時(起床時間と TIME が一致した時)にだけ呼び出される関数, 初期化等
@ROOM_SMELL_MORNING(LOCAL:0,LOCAL:1,LOCAL:2,LOCAL:3)
#DIM LOOP_ROOM
#DIM LOOP_CHARA
#DIM LOOP_1

;起床時ににおい更新時刻を記録
FLAG:(LOCAL:1) = TIME

;各部屋の汚れ具合によるにおいを上書き及び初期化
FOR LOOP_ROOM,1,場所番号最大値 + 1
	SELECTCASE FLAG:(100 + LOOP_ROOM)
			;最高 ～ やや高
		CASE IS < 1000
			FLAG:(LOCAL:0 + LOOP_ROOM) = 0
			FLAG:(LOCAL:1 + LOOP_ROOM) = 0
			;中
		CASE IS < 2000
			FLAG:(LOCAL:0 + LOOP_ROOM) = 05000001
			FLAG:(LOCAL:1 + LOOP_ROOM) = 0
			;やや低
		CASE IS < 3500
			FLAG:(LOCAL:0 + LOOP_ROOM) = 01000001
			FLAG:(LOCAL:1 + LOOP_ROOM) = 0
			;低
		CASE IS < 5000
			FLAG:(LOCAL:0 + LOOP_ROOM) = 02000001
			FLAG:(LOCAL:1 + LOOP_ROOM) = 0
			;ゴミの山
		CASEELSE
			FLAG:(LOCAL:0 + LOOP_ROOM) = 04500001
			FLAG:(LOCAL:1 + LOOP_ROOM) = 0
	ENDSELECT
	;PRINTFORML 朝の部屋汚し処理：%GETPLACENAME(LOOP_ROOM)%, 部屋番号{LOOP_ROOM}, 汚れ具合{FLAG:(100+LOOP_ROOM)}, {FLAG:(LOCAL:0+LOOP_ROOM)}
NEXT

;各キャラの体臭を日毎に増し、各部屋に追加. さらに他人のにおいを初期化
FOR LOOP_CHARA,0,CHARANUM
	FOR LOOP_1, 0, 3
		CFLAG:LOOP_CHARA:(角色的气味_别人的气味_1 + LOOP_1) = 0
	NEXT
	SIF HAS_PENIS(LOOP_CHARA)
		CFLAG:LOOP_CHARA:(LOCAL:2) *= 3 / 2
	LOCAL:20 = CFLAG:LOOP_CHARA:(LOCAL:2) / 2
	CFLAG:LOOP_CHARA:(LOCAL:2) += LOCAL:20
	SIF CFLAG:LOOP_CHARA:(LOCAL:2) == 0
		CFLAG:LOOP_CHARA:(LOCAL:2) = 1
	SIF CFLAG:LOOP_CHARA:(LOCAL:2) == 0
		CFLAG:LOOP_CHARA:(LOCAL:2) = LOCAL:3
	CFLAG:LOOP_CHARA:角色的气味_自己的气味 = 0
	;PRINTFORML 各キャラの体臭：%CALLNAME:LOOP_CHARA%, キャラ番号{LOOP_CHARA}, 体臭{CFLAG:LOOP_CHARA:(LOCAL:2)}
	SIF CFLAG:LOOP_CHARA:(LOCAL:2) > 99
		CFLAG:LOOP_CHARA:(LOCAL:2) = 99
	;PRINTFORML {CFLAG:LOOP_CHARA:当前位置}, {LOOP_CHARA}, {CFLAG:LOOP_CHARA:(LOCAL:2)}, {气味类型_体臭}
	CALL ROOM_SMELL_ROOM_SUB(CFLAG:LOOP_CHARA:当前位置, LOOP_CHARA, CFLAG:LOOP_CHARA:(LOCAL:2), 气味类型_体臭)
	;LOCAL:10 = ROOM_SMELL_WHOSE(FLAG:(500+CFLAG:LOOP_CHARA:当前位置))
	;LOCAL:11 = ROOM_SMELL_VALUE(FLAG:(500+CFLAG:LOOP_CHARA:当前位置))
	;LOCAL:12 = ROOM_SMELL_BIT(FLAG:(500+CFLAG:LOOP_CHARA:当前位置))
	;PRINTFORML {CFLAG:LOOP_CHARA:当前位置}, {LOCAL:10}, {LOCAL:11}, {LOCAL:12}, {FLAG:(500+CFLAG:LOOP_CHARA:当前位置)}
	;LOCAL:10 = ROOM_SMELL_WHOSE(FLAG:(550+CFLAG:LOOP_CHARA:当前位置))
	;LOCAL:11 = ROOM_SMELL_VALUE(FLAG:(550+CFLAG:LOOP_CHARA:当前位置))
	;LOCAL:12 = ROOM_SMELL_BIT(FLAG:(550+CFLAG:LOOP_CHARA:当前位置))
	;PRINTFORML {CFLAG:LOOP_CHARA:当前位置}, {LOCAL:10}, {LOCAL:11}, {LOCAL:12}, {FLAG:(550+CFLAG:LOOP_CHARA:当前位置)}
	;PRINTL 

	;PRINTFORML {LOOP_CHARA}, {ROOM_SMELL_WHOSE_SAMEN(LOOP_CHARA)}
	;前日に中出しされ, 洗わなかったら翌日ににおう
	IF (CFLAG:LOOP_CHARA:角色的气味_膣内精液の主 >= 0 && CFLAG:LOOP_CHARA:角色的气味_膣内精液の主 < CHARANUM) || (CFLAG:LOOP_CHARA:角色的气味_膣内精液の主 >= 人物_村人 && CFLAG:LOOP_CHARA:角色的气味_膣内精液の主 <= 人物_客)
		CALL ROOM_SMELL_CHARA_SUB(LOOP_CHARA, CFLAG:LOOP_CHARA:角色的气味_膣内精液の主, においの強さ_精液_熟成, 气味类型B_精液)
		;前日に中出しされなくとも子宮内の精液がほのかににおう
	ELSEIF ROOM_SMELL_WHOSE_SAMEN(LOOP_CHARA)
		CALL ROOM_SMELL_CHARA_SUB(LOOP_CHARA, ROOM_SMELL_WHOSE_SAMEN(LOOP_CHARA), CFLAG:LOOP_CHARA:(LOCAL:2) , 气味类型B_精液)
	ENDIF
	SIF ROOM_SMELL_BIT(ROOM_SMELL_CHARA_MOST(LOOP_CHARA)) != 气味类型B_体臭
		CALL ROOM_SMELL_ROOM_SUB(CFLAG:LOOP_CHARA:当前位置, ROOM_SMELL_WHOSE(ROOM_SMELL_CHARA_MOST(LOOP_CHARA)), ROOM_SMELL_VALUE(ROOM_SMELL_CHARA_MOST(LOOP_CHARA)), ROOM_SMELL_BIT(ROOM_SMELL_CHARA_MOST(LOOP_CHARA)))
	CFLAG:LOOP_CHARA:角色的气味_膣内精液の主 = -1
NEXT
;訪問者の体臭を初期化
FLAG:訪問者の他人のにおい = 人物_訪問者 * 10000000 + においの強さ_訪問者の体臭 * 100000 + 气味类型_体臭

RETURN 0



;日中の処理, 何度も呼び出される関数なので扱いに注意
@ROOM_SMELL_DAY(LOCAL:0,LOCAL:1,LOCAL:2)
;LOCAL:10	一時変数
;LOCAL:11	一時変数
;LOCAL:12	一時変数
;LOCAL:20	一時変数

#DIM LOOP_ROOM
#DIM LOOP_CHARA
#DIM LOOP_1
#DIM LOOP_2
#DIM 阴茎のにおい
#DIM 受け側
#DIM 攻め側

;風呂に入るとにおいが消える
FOR LOOP_CHARA, 0, CHARANUM
	IF 存在浴室(CFLAG:LOOP_CHARA:当前位置)
		CFLAG:LOOP_CHARA:角色的气味_初期CFLAG = 1
		CFLAG:LOOP_CHARA:角色的气味_自己的气味 = 0
		CFLAG:LOOP_CHARA:角色的气味_膣内精液の主 = -1
		FOR LOOP_1, 0, 3
			CFLAG:LOOP_CHARA:(角色的气味_别人的气味_1 + LOOP_1) = 0
		NEXT
	ENDIF
NEXT

;各キャラに対して適用する処理
FOR LOOP_CHARA, 0, CHARANUM
	;PRINTFORML {LOOP_CHARA}, {CFLAG:LOOP_CHARA:角色的气味_自己的气味}
	;各キャラで自分のにおいを作成
	CALL ROOM_SMELL_CHARA_SMELL_CREATE(LOOP_CHARA)
	;PRINTFORML {LOOP_CHARA}, {CFLAG:LOOP_CHARA:角色的气味_自己的气味}

	;カウンターセクハラ処理
	;抱擁など体をくっつける系はにおいをつける
	IF (TCVAR:LOOP_CHARA >= CNT_キス && TCVAR:LOOP_CHARA <= CNT_対面抱擁) || TCVAR:LOOP_CHARA == CNT_胸を揉む || (TCVAR:LOOP_CHARA >= CNT_胸爱抚 && TCVAR:LOOP_CHARA <= CNT_ディープキス) || (TCVAR:LOOP_CHARA >= CNT_ぱふぱふ && TCVAR:LOOP_CHARA <= CNT_乳合わせ)
		CALL ROOM_SMELL_CHARA_SUB(人物_あなた, LOOP_CHARA, ROOM_SMELL_VALUE(CFLAG:LOOP_CHARA:角色的气味_自己的气味), ROOM_SMELL_BIT(CFLAG:LOOP_CHARA:角色的气味_自己的气味))
		CALL ROOM_SMELL_CHARA_SUB(LOOP_CHARA, 人物_あなた, ROOM_SMELL_VALUE(CFLAG:人物_あなた:角色的气味_自己的气味), ROOM_SMELL_BIT(CFLAG:人物_あなた:角色的气味_自己的气味))
		;股間に触れたりするものもにおいをつける(においの移り先があなた→住人)
	ELSEIF TCVAR:LOOP_CHARA == CNT_股間をまさぐる || (TCVAR:LOOP_CHARA >= CNT_手淫 && TCVAR:LOOP_CHARA <= CNT_指挿入)
		LOCAL:11 = 0
		LOCAL:12 = 0
		IF PALAM:人物_あなた:润滑 > PALAMLV:3 && HAS_VAGINA(人物_あなた)
			SETBIT LOCAL:12, 气味类型B_愛液
			LOCAL:11 = においの強さ_愛液_ぐっしょり
		ELSEIF PALAM:人物_あなた:润滑 > PALAMLV:1 && HAS_VAGINA(人物_あなた)
			SETBIT LOCAL:12, 气味类型B_愛液
			LOCAL:11 = においの強さ_愛液_しっとり
		ENDIF
		IF HAS_PENIS(人物_あなた)
			IF GETBIT(STAIN:人物_あなた:部位_Ｐ, 汚れB_精液)
				IF MAXBASE:人物_あなた:精力 > BASE:人物_あなた:精力
					SETBIT LOCAL:12, 气味类型B_精液
					LOCAL:11 = においの強さ_精液_少量
				ENDIF
			ENDIF
		ENDIF
		CALL ROOM_SMELL_CHARA_SUB(LOOP_CHARA, 人物_あなた, LOCAL:11, LOCAL:12)
		;股間に触れたりするものもにおいをつける(においの移り先が住人→あなた)
	ELSEIF (TCVAR:LOOP_CHARA >= CNT_强制舔阴 && TCVAR:LOOP_CHARA <= CNT_舔肛侍奉) || TCVAR:LOOP_CHARA == CNT_タワシ洗い
		LOCAL:11 = 0
		LOCAL:12 = 0
		IF PALAM:LOOP_CHARA:润滑 > PALAMLV:3 && HAS_VAGINA(LOOP_CHARA)
			SETBIT LOCAL:12, 气味类型B_愛液
			LOCAL:11 = においの強さ_愛液_ぐっしょり
		ELSEIF PALAM:LOOP_CHARA:润滑 > PALAMLV:1 && HAS_VAGINA(LOOP_CHARA)
			SETBIT LOCAL:12, 气味类型B_愛液
			LOCAL:11 = においの強さ_愛液_しっとり
		ENDIF
		IF HAS_PENIS(LOOP_CHARA)
			IF GETBIT(STAIN:LOOP_CHARA:部位_Ｐ, 汚れB_精液)
				IF MAXBASE:LOOP_CHARA:精力 > BASE:LOOP_CHARA:精力
					SETBIT LOCAL:12, 气味类型B_精液
					LOCAL:11 = においの強さ_精液_少量
				ENDIF
			ENDIF
		ENDIF
		CALL ROOM_SMELL_CHARA_SUB(人物_あなた, LOOP_CHARA, LOCAL:11, LOCAL:12)
		;セックス系(お互いににおいが移る)
	ELSEIF (TCVAR:LOOP_CHARA >= CNT_正常位挿入される && TCVAR:LOOP_CHARA <= CNT_背面座位A挿入される) || TCVAR:LOOP_CHARA == CNT_骑乘位逆强奸
		CALL ROOM_SMELL_CHARA_SUB(人物_あなた, LOOP_CHARA, ROOM_SMELL_VALUE(CFLAG:LOOP_CHARA:角色的气味_自己的气味), ROOM_SMELL_BIT(CFLAG:LOOP_CHARA:角色的气味_自己的气味))
		CALL ROOM_SMELL_CHARA_SUB(LOOP_CHARA, 人物_あなた, ROOM_SMELL_VALUE(CFLAG:人物_あなた:角色的气味_自己的气味), ROOM_SMELL_BIT(CFLAG:人物_あなた:角色的气味_自己的气味))

		LOCAL:11 = 0
		LOCAL:12 = 0
		IF PALAM:人物_あなた:润滑 > PALAMLV:3 && HAS_VAGINA(人物_あなた)
			SETBIT LOCAL:12, 气味类型B_愛液
			LOCAL:11 = においの強さ_愛液_ぐっしょり
		ELSEIF PALAM:人物_あなた:润滑 > PALAMLV:1 && HAS_VAGINA(人物_あなた)
			SETBIT LOCAL:12, 气味类型B_愛液
			LOCAL:11 = においの強さ_愛液_しっとり
		ENDIF
		IF HAS_PENIS(人物_あなた)
			IF GETBIT(STAIN:人物_あなた:部位_Ｐ, 汚れB_精液)
				IF MAXBASE:人物_あなた:精力 > BASE:人物_あなた:精力
					SETBIT LOCAL:12, 气味类型B_精液
					SIF LOCAL:11 < においの強さ_精液_少量
						LOCAL:11 = においの強さ_精液_少量
				ENDIF
			ENDIF
		ENDIF
		CALL ROOM_SMELL_CHARA_SUB(LOOP_CHARA, 人物_あなた, LOCAL:11, LOCAL:12)

		LOCAL:11 = 0
		LOCAL:12 = 0
		IF PALAM:LOOP_CHARA:润滑 > PALAMLV:3 && HAS_VAGINA(LOOP_CHARA)
			SETBIT LOCAL:12, 气味类型B_愛液
			LOCAL:11 = においの強さ_愛液_ぐっしょり
		ELSEIF PALAM:LOOP_CHARA:润滑 > PALAMLV:1 && HAS_VAGINA(LOOP_CHARA)
			SETBIT LOCAL:12, 气味类型B_愛液
			LOCAL:11 = においの強さ_愛液_しっとり
		ENDIF
		IF HAS_PENIS(LOOP_CHARA)
			IF GETBIT(STAIN:LOOP_CHARA:部位_Ｐ, 汚れB_精液)
				IF MAXBASE:LOOP_CHARA:精力 > BASE:LOOP_CHARA:精力
					SETBIT LOCAL:12, 气味类型B_精液
					SIF LOCAL:11 < においの強さ_精液_少量
						LOCAL:11 = においの強さ_精液_少量
				ENDIF
			ENDIF
		ENDIF
		CALL ROOM_SMELL_CHARA_SUB(人物_あなた, LOOP_CHARA, LOCAL:11, LOCAL:12)
	ENDIF

	;住人同士交流処理　処理は上に準拠
	LOCAL:20 = CFLAG:LOOP_CHARA:住人同士イベント内容 / 10
	IF LOCAL:20
		IF CFLAG:LOOP_CHARA:住人同士イベント内容 % 10 == 0
			受け側 = LOOP_CHARA
			攻め側 = CFLAG:LOOP_CHARA:住人同士イベント相手
		ELSE
			受け側 = CFLAG:LOOP_CHARA:住人同士イベント相手
			攻め側 = LOOP_CHARA
		ENDIF
		IF LOCAL:20 == 住人同士行为_身体接触 || (LOCAL:20 >= 住人同士行为_抱きつく && LOCAL:20 <= 住人同士行为_胸爱抚)
			CALL ROOM_SMELL_CHARA_SUB(受け側, 攻め側, ROOM_SMELL_VALUE(CFLAG:攻め側:角色的气味_自己的气味), ROOM_SMELL_BIT(CFLAG:攻め側:角色的气味_自己的气味))
			CALL ROOM_SMELL_CHARA_SUB(攻め側, 受け側, ROOM_SMELL_VALUE(CFLAG:受け側:角色的气味_自己的气味), ROOM_SMELL_BIT(CFLAG:受け側:角色的气味_自己的气味))
			;股間に触れたりするものもにおいをつける(においの移り先が受け側→攻め側)
		ELSEIF LOCAL:20 >= 住人同士行为_肛门爱抚 && LOCAL:20 <= 住人同士行为_手指插入
			LOCAL:11 = 0
			LOCAL:12 = 0
			IF PALAM:受け側:润滑 > PALAMLV:3 && HAS_VAGINA(受け側)
				SETBIT LOCAL:12, 气味类型B_愛液
				LOCAL:11 = においの強さ_愛液_ぐっしょり
			ELSEIF PALAM:人物_あなた:润滑 > PALAMLV:1 && HAS_VAGINA(受け側)
				SETBIT LOCAL:12, 气味类型B_愛液
				LOCAL:11 = においの強さ_愛液_しっとり
			ENDIF
			IF HAS_PENIS(受け側)
				IF GETBIT(STAIN:受け側:部位_Ｐ, 汚れB_精液)
					IF MAXBASE:受け側:精力 > BASE:受け側:精力
						SETBIT LOCAL:12, 气味类型B_精液
						LOCAL:11 = においの強さ_精液_少量
					ENDIF
				ENDIF
			ENDIF
			CALL ROOM_SMELL_CHARA_SUB(攻め側, 受け側, LOCAL:11, LOCAL:12)
			;セックス系(お互いににおいが移る)
		ELSEIF LOCAL:20 >= 住人同士行为_Ｖ性交Ｎ && LOCAL:20 <= 住人同士行为_Ａ後戯Ｃ
			CALL ROOM_SMELL_CHARA_SUB(受け側, 攻め側, ROOM_SMELL_VALUE(CFLAG:攻め側:角色的气味_自己的气味), ROOM_SMELL_BIT(CFLAG:攻め側:角色的气味_自己的气味))
			CALL ROOM_SMELL_CHARA_SUB(攻め側, 受け側, ROOM_SMELL_VALUE(CFLAG:受け側:角色的气味_自己的气味), ROOM_SMELL_BIT(CFLAG:受け側:角色的气味_自己的气味))

			LOCAL:11 = 0
			LOCAL:12 = 0
			IF PALAM:受け側:润滑 > PALAMLV:3 && HAS_VAGINA(受け側)
				SETBIT LOCAL:12, 气味类型B_愛液
				LOCAL:11 = においの強さ_愛液_ぐっしょり
			ELSEIF PALAM:人物_あなた:润滑 > PALAMLV:1 && HAS_VAGINA(受け側)
				SETBIT LOCAL:12, 气味类型B_愛液
				LOCAL:11 = においの強さ_愛液_しっとり
			ENDIF
			IF HAS_PENIS(受け側)
				IF GETBIT(STAIN:受け側:部位_Ｐ, 汚れB_精液)
					IF MAXBASE:受け側:精力 > BASE:受け側:精力
						SETBIT LOCAL:12, 气味类型B_精液
						SIF LOCAL:11 < においの強さ_精液_少量
							LOCAL:11 = においの強さ_精液_少量
					ENDIF
				ENDIF
			ENDIF
			CALL ROOM_SMELL_CHARA_SUB(攻め側, 受け側, LOCAL:11, LOCAL:12)

			LOCAL:11 = 0
			LOCAL:12 = 0
			IF PALAM:攻め側:润滑 > PALAMLV:3 && HAS_VAGINA(攻め側)
				SETBIT LOCAL:12, 气味类型B_愛液
				LOCAL:11 = においの強さ_愛液_ぐっしょり
			ELSEIF PALAM:攻め側:润滑 > PALAMLV:1 && HAS_VAGINA(攻め側)
				SETBIT LOCAL:12, 气味类型B_愛液
				LOCAL:11 = においの強さ_愛液_しっとり
			ENDIF
			IF HAS_PENIS(攻め側)
				IF GETBIT(STAIN:攻め側:部位_Ｐ, 汚れB_精液)
					IF MAXBASE:攻め側:精力 > BASE:攻め側:精力
						SETBIT LOCAL:12, 气味类型B_精液
						SIF LOCAL:11 < においの強さ_精液_少量
							LOCAL:11 = においの強さ_精液_少量
					ENDIF
				ENDIF
			ENDIF
			CALL ROOM_SMELL_CHARA_SUB(受け側, 攻め側, LOCAL:11, LOCAL:12)
		ENDIF
	ENDIF

	;射精処理
	;射精(中出し)された側で処理し, 強い精液のにおいが植えつけられる
	FOR LOOP_1, 0, 2
		;PRINTFORML {LOOP_CHARA}, {TCVAR:LOOP_CHARA:(102 + LOOP_1 * 2)}, {TCVAR:LOOP_CHARA:(103 + LOOP_1 * 2)}
		IF TCVAR:LOOP_CHARA:(102 + LOOP_1 * 2)
			IF TCVAR:LOOP_CHARA:(103 + LOOP_1 * 2) >= CHARANUM
				IF TCVAR:LOOP_CHARA:(103 + LOOP_1 * 2) == 精子主_村人 || TCVAR:LOOP_CHARA:(103 + LOOP_1 * 2) == 人物_村人
					LOCAL:10 = 人物_村人
				ELSEIF TCVAR:LOOP_CHARA:(103 + LOOP_1 * 2) == 精子主_訪問者 || TCVAR:LOOP_CHARA:(103 + LOOP_1 * 2) == 人物_訪問者
					LOCAL:10 = 人物_訪問者
				ELSEIF TCVAR:LOOP_CHARA:(103 + LOOP_1 * 2) == 精子主_客 || TCVAR:LOOP_CHARA:(103 + LOOP_1 * 2) == 人物_客
					LOCAL:10 = 人物_客
				ENDIF
			ELSE
				LOCAL:10 = TCVAR:LOOP_CHARA:(103 + LOOP_1 * 2)
			ENDIF
			;PRINTFORMW {LOOP_CHARA}, {LOCAL:10}
			CALL ROOM_SMELL_CHARA_SUB(LOOP_CHARA, LOCAL:10, においの強さ_精液_大量, 气味类型_精液)
			IF LOCAL:10 < CHARANUM
				CALL ROOM_SMELL_CHARA_SUB(LOCAL:10, LOCAL:10, においの強さ_精液_少量, 气味类型_精液)
			ELSEIF LOCAL:10 == 人物_訪問者
				CALL ROOM_SMELL_VISITER_SUB(人物_訪問者, においの強さ_精液_少量, 气味类型_精液)
			ENDIF
			CFLAG:LOOP_CHARA:角色的气味_膣内精液の主 = LOCAL:10
		ENDIF
	NEXT

	;うふふ中の処理
	IF CFLAG:LOOP_CHARA:うふふ
		FOR LOOP_1, 0, CHARANUM
			SIF LOOP_CHARA == LOOP_1
				CONTINUE
			;うふふ中の相手に対する処理
			IF CFLAG:LOOP_1:うふふ
				;自分のにおいを相手につける
				CALL ROOM_SMELL_CHARA_SUB(LOOP_1, LOOP_CHARA, ROOM_SMELL_VALUE(CFLAG:LOOP_CHARA:角色的气味_自己的气味), ROOM_SMELL_BIT(CFLAG:LOOP_CHARA:角色的气味_自己的气味))
				;自分についた他人のにおいを相手に1/3の強さでつける
				FOR LOOP_2, 0, 3
					CALL ROOM_SMELL_CHARA_SUB(LOOP_1, ROOM_SMELL_WHOSE(CFLAG:LOOP_CHARA:(角色的气味_别人的气味_1 + LOOP_2)), ROOM_SMELL_VALUE(CFLAG:LOOP_CHARA:(角色的气味_别人的气味_1 + LOOP_2)) / 3, ROOM_SMELL_BIT(CFLAG:LOOP_CHARA:(角色的气味_别人的气味_1 + LOOP_2)))
				NEXT
			ENDIF
		NEXT
	ENDIF

	;訪問者関連の処理
	;訪問者に住人のにおいがついている場合は1/3の強さになって伝染
	;住人のにおいがついていない場合は訪問者のにおいを住人に植え付ける
	IF CFLAG:LOOP_CHARA:333 >= NTR_行为_接吻 && CFLAG:LOOP_CHARA:333 <= NTR_行为_胸爱抚
		CALL ROOM_SMELL_NTR_PET(LOOP_CHARA)
	ELSEIF CFLAG:LOOP_CHARA:333 == NTR_行为_口交
		CALL ROOM_SMELL_NTR_ORAL(LOOP_CHARA)
	ELSEIF CFLAG:LOOP_CHARA:333 >= NTR_行为_六九 && CFLAG:LOOP_CHARA:333 <= NTR_行为_Ａ背面立位
		CALL ROOM_SMELL_NTR_SEX(LOOP_CHARA)
	ENDIF
NEXT

;コマンド実行系処理
;爱抚系(においは住人→あなた)
IF SELECTCOM <= 10 || SELECTCOM == 123 || (SELECTCOM >= 141 && SELECTCOM <= 144) || SELECTCOM == 503 || SELECTCOM == 514
	LOCAL:11 = 0
	LOCAL:12 = 0
	IF PALAM:TARGET:润滑 > PALAMLV:3 && HAS_VAGINA(TARGET)
		SETBIT LOCAL:12, 气味类型B_愛液
		LOCAL:11 = においの強さ_愛液_ぐっしょり
	ELSEIF PALAM:TARGET:润滑 > PALAMLV:1 && HAS_VAGINA(TARGET)
		SETBIT LOCAL:12, 气味类型B_愛液
		LOCAL:11 = においの強さ_愛液_しっとり
	ENDIF
	IF HAS_PENIS(TARGET)
		IF GETBIT(STAIN:TARGET:部位_Ｐ, 汚れB_精液)
			IF MAXBASE:TARGET:精力 > BASE:TARGET:精力
				SETBIT LOCAL:12, 气味类型B_精液
				LOCAL:11 = においの強さ_精液_少量
			ENDIF
		ENDIF
	ENDIF
	CALL ROOM_SMELL_CHARA_SUB(人物_あなた, TARGET, LOCAL:11, LOCAL:12)
	;侍奉系(においはあなた→住人)
ELSEIF (SELECTCOM >= 80 && SELECTCOM <= 91) || (SELECTCOM >= 95 && SELECTCOM <= 96) || SELECTCOM == 120 || SELECTCOM == 140 || SELECTCOM == 145 || SELECTCOM == 505 || SELECTCOM == 512 || SELECTCOM == 515 || SELECTCOM == 516 || (SELECTCOM >= 314 && SELECTCOM <= 316)
	LOCAL:11 = 0
	LOCAL:12 = 0
	IF PALAM:人物_あなた:润滑 > PALAMLV:3 && HAS_VAGINA(人物_あなた)
		SETBIT LOCAL:12, 气味类型B_愛液
		LOCAL:11 = においの強さ_愛液_ぐっしょり
	ELSEIF PALAM:人物_あなた:润滑 > PALAMLV:1 && HAS_VAGINA(人物_あなた)
		SETBIT LOCAL:12, 气味类型B_愛液
		LOCAL:11 = においの強さ_愛液_しっとり
	ENDIF
	IF HAS_PENIS(人物_あなた)
		IF GETBIT(STAIN:人物_あなた:部位_Ｐ, 汚れB_精液)
			IF MAXBASE:人物_あなた:精力 > BASE:人物_あなた:精力
				SETBIT LOCAL:12, 气味类型B_精液
				LOCAL:11 = においの強さ_精液_少量
			ENDIF
		ENDIF
	ENDIF
	CALL ROOM_SMELL_CHARA_SUB(TARGET, 人物_あなた, LOCAL:11, LOCAL:12)
	IF ASSI && (SELECTCOM == 509 || SELECTCOM == 511)
		LOCAL:11 = 0
		LOCAL:12 = 0
		IF PALAM:人物_あなた:润滑 > PALAMLV:3 && HAS_VAGINA(人物_あなた)
			SETBIT LOCAL:12, 气味类型B_愛液
			LOCAL:11 = においの強さ_愛液_ぐっしょり
		ELSEIF PALAM:人物_あなた:润滑 > PALAMLV:1 && HAS_VAGINA(人物_あなた)
			SETBIT LOCAL:12, 气味类型B_愛液
			LOCAL:11 = においの強さ_愛液_しっとり
		ENDIF
		IF HAS_PENIS(人物_あなた)
			IF GETBIT(STAIN:人物_あなた:部位_Ｐ, 汚れB_精液)
				IF MAXBASE:人物_あなた:精力 > BASE:人物_あなた:精力
					SETBIT LOCAL:12, 气味类型B_精液
					LOCAL:11 = においの強さ_精液_少量
				ENDIF
			ENDIF
		ENDIF
		CALL ROOM_SMELL_CHARA_SUB(ASSI, 人物_あなた, LOCAL:11, LOCAL:12)
	ENDIF
	;コミュニケーション系
ELSEIF SELECTCOM == 20 || SELECTCOM == 126 || SELECTCOM == 302 || (SELECTCOM >= 310 && SELECTCOM <= 313) || SELECTCOM == 351
	CALL ROOM_SMELL_CHARA_SUB(人物_あなた, TARGET, ROOM_SMELL_VALUE(CFLAG:TARGET:角色的气味_自己的气味), ROOM_SMELL_BIT(CFLAG:TARGET:角色的气味_自己的气味))
	CALL ROOM_SMELL_CHARA_SUB(TARGET, 人物_あなた, ROOM_SMELL_VALUE(CFLAG:人物_あなた:角色的气味_自己的气味), ROOM_SMELL_BIT(CFLAG:人物_あなた:角色的气味_自己的气味))
	;セックス系
ELSEIF (SELECTCOM >= 60 && SELECTCOM <= 72) || (SELECTCOM >= 92 && SELECTCOM <= 94) || (SELECTCOM >= 97 && SELECTCOM <= 99) || SELECTCOM == 121 || (SELECTCOM >= 502 && SELECTCOM <= 503) || SELECTCOM == 504 || (SELECTCOM >= 506 && SELECTCOM <= 507) || SELECTCOM == 513
	CALL ROOM_SMELL_CHARA_SUB(人物_あなた, TARGET, ROOM_SMELL_VALUE(CFLAG:TARGET:角色的气味_自己的气味), ROOM_SMELL_BIT(CFLAG:TARGET:角色的气味_自己的气味))
	CALL ROOM_SMELL_CHARA_SUB(TARGET, 人物_あなた, ROOM_SMELL_VALUE(CFLAG:人物_あなた:角色的气味_自己的气味), ROOM_SMELL_BIT(CFLAG:人物_あなた:角色的气味_自己的气味))

	LOCAL:11 = 0
	LOCAL:12 = 0
	IF PALAM:人物_あなた:润滑 > PALAMLV:3 && HAS_VAGINA(人物_あなた)
		SETBIT LOCAL:12, 气味类型B_愛液
		LOCAL:11 = においの強さ_愛液_ぐっしょり
	ELSEIF PALAM:人物_あなた:润滑 > PALAMLV:1 && HAS_VAGINA(人物_あなた)
		SETBIT LOCAL:12, 气味类型B_愛液
		LOCAL:11 = においの強さ_愛液_しっとり
	ENDIF
	IF HAS_PENIS(人物_あなた)
		IF GETBIT(STAIN:人物_あなた:部位_Ｐ, 汚れB_精液)
			IF MAXBASE:人物_あなた:精力 > BASE:人物_あなた:精力
				SETBIT LOCAL:12, 气味类型B_精液
				SIF LOCAL:11 < においの強さ_精液_少量
					LOCAL:11 = においの強さ_精液_少量
			ENDIF
		ENDIF
	ENDIF
	CALL ROOM_SMELL_CHARA_SUB(TARGET, 人物_あなた, LOCAL:11, LOCAL:12)

	LOCAL:11 = 0
	LOCAL:12 = 0
	IF PALAM:TARGET:润滑 > PALAMLV:3 && HAS_VAGINA(TARGET)
		SETBIT LOCAL:12, 气味类型B_愛液
		LOCAL:11 = においの強さ_愛液_ぐっしょり
	ELSEIF PALAM:TARGET:润滑 > PALAMLV:1 && HAS_VAGINA(TARGET)
		SETBIT LOCAL:12, 气味类型B_愛液
		LOCAL:11 = においの強さ_愛液_しっとり
	ENDIF
	IF HAS_PENIS(TARGET)
		IF GETBIT(STAIN:TARGET:部位_Ｐ, 汚れB_精液)
			IF MAXBASE:TARGET:精力 > BASE:TARGET:精力
				SETBIT LOCAL:12, 气味类型B_精液
				SIF LOCAL:11 < においの強さ_精液_少量
					LOCAL:11 = においの強さ_精液_少量
			ENDIF
		ENDIF
	ENDIF
	CALL ROOM_SMELL_CHARA_SUB(人物_あなた, TARGET, LOCAL:11, LOCAL:12)
	IF ASSI && (SELECTCOM == 513)
		CALL ROOM_SMELL_CHARA_SUB(人物_あなた, ASSI, ROOM_SMELL_VALUE(CFLAG:ASSI:角色的气味_自己的气味), ROOM_SMELL_BIT(CFLAG:ASSI:角色的气味_自己的气味))
		CALL ROOM_SMELL_CHARA_SUB(ASSI, 人物_あなた, ROOM_SMELL_VALUE(CFLAG:人物_あなた:角色的气味_自己的气味), ROOM_SMELL_BIT(CFLAG:人物_あなた:角色的气味_自己的气味))

		LOCAL:11 = 0
		LOCAL:12 = 0
		IF PALAM:人物_あなた:润滑 > PALAMLV:3 && HAS_VAGINA(人物_あなた)
			SETBIT LOCAL:12, 气味类型B_愛液
			LOCAL:11 = においの強さ_愛液_ぐっしょり
		ELSEIF PALAM:人物_あなた:润滑 > PALAMLV:1 && HAS_VAGINA(人物_あなた)
			SETBIT LOCAL:12, 气味类型B_愛液
			LOCAL:11 = においの強さ_愛液_しっとり
		ENDIF
		IF HAS_PENIS(人物_あなた)
			IF GETBIT(STAIN:人物_あなた:部位_Ｐ, 汚れB_精液)
				IF MAXBASE:人物_あなた:精力 > BASE:人物_あなた:精力
					SETBIT LOCAL:12, 气味类型B_精液
					SIF LOCAL:11 < においの強さ_精液_少量
						LOCAL:11 = においの強さ_精液_少量
				ENDIF
			ENDIF
		ENDIF
		CALL ROOM_SMELL_CHARA_SUB(ASSI, 人物_あなた, LOCAL:11, LOCAL:12)

		LOCAL:11 = 0
		LOCAL:12 = 0
		IF PALAM:ASSI:润滑 > PALAMLV:3 && HAS_VAGINA(ASSI)
			SETBIT LOCAL:12, 气味类型B_愛液
			LOCAL:11 = においの強さ_愛液_ぐっしょり
		ELSEIF PALAM:ASSI:润滑 > PALAMLV:1 && HAS_VAGINA(ASSI)
			SETBIT LOCAL:12, 气味类型B_愛液
			LOCAL:11 = においの強さ_愛液_しっとり
		ENDIF
		IF HAS_PENIS(ASSI)
			IF GETBIT(STAIN:ASSI:部位_Ｐ, 汚れB_精液)
				IF MAXBASE:ASSI:精力 > BASE:ASSI:精力
					SETBIT LOCAL:12, 气味类型B_精液
					SIF LOCAL:11 < においの強さ_精液_少量
						LOCAL:11 = においの強さ_精液_少量
				ENDIF
			ENDIF
		ENDIF
		CALL ROOM_SMELL_CHARA_SUB(人物_あなた, ASSI, LOCAL:11, LOCAL:12)
	ENDIF
	;セックス系(助手)
ELSEIF ASSI && (SELECTCOM == 122)
	CALL ROOM_SMELL_CHARA_SUB(ASSI, TARGET, ROOM_SMELL_VALUE(CFLAG:TARGET:角色的气味_自己的气味), ROOM_SMELL_BIT(CFLAG:TARGET:角色的气味_自己的气味))
	CALL ROOM_SMELL_CHARA_SUB(TARGET, ASSI, ROOM_SMELL_VALUE(CFLAG:ASSI:角色的气味_自己的气味), ROOM_SMELL_BIT(CFLAG:ASSI:角色的气味_自己的气味))

	LOCAL:11 = 0
	LOCAL:12 = 0
	IF PALAM:ASSI:润滑 > PALAMLV:3 && HAS_VAGINA(ASSI)
		SETBIT LOCAL:12, 气味类型B_愛液
		LOCAL:11 = においの強さ_愛液_ぐっしょり
	ELSEIF PALAM:ASSI:润滑 > PALAMLV:1 && HAS_VAGINA(ASSI)
		SETBIT LOCAL:12, 气味类型B_愛液
		LOCAL:11 = においの強さ_愛液_しっとり
	ENDIF
	IF HAS_PENIS(ASSI)
		IF GETBIT(STAIN:ASSI:部位_Ｐ, 汚れB_精液)
			IF MAXBASE:ASSI:精力 > BASE:ASSI:精力
				SETBIT LOCAL:12, 气味类型B_精液
				SIF LOCAL:11 < においの強さ_精液_少量
					LOCAL:11 = においの強さ_精液_少量
			ENDIF
		ENDIF
	ENDIF
	CALL ROOM_SMELL_CHARA_SUB(TARGET, ASSI, LOCAL:11, LOCAL:12)

	LOCAL:11 = 0
	LOCAL:12 = 0
	IF PALAM:TARGET:润滑 > PALAMLV:3 && HAS_VAGINA(TARGET)
		SETBIT LOCAL:12, 气味类型B_愛液
		LOCAL:11 = においの強さ_愛液_ぐっしょり
	ELSEIF PALAM:TARGET:润滑 > PALAMLV:1 && HAS_VAGINA(TARGET)
		SETBIT LOCAL:12, 气味类型B_愛液
		LOCAL:11 = においの強さ_愛液_しっとり
	ENDIF
	IF HAS_PENIS(TARGET)
		IF GETBIT(STAIN:TARGET:部位_Ｐ, 汚れB_精液)
			IF MAXBASE:TARGET:精力 > BASE:TARGET:精力
				SETBIT LOCAL:12, 气味类型B_精液
				SIF LOCAL:11 < においの強さ_精液_少量
					LOCAL:11 = においの強さ_精液_少量
			ENDIF
		ENDIF
	ENDIF
	CALL ROOM_SMELL_CHARA_SUB(ASSI, TARGET, LOCAL:11, LOCAL:12)
	;セックス系(あなたと助手)
ELSEIF ASSI && SELECTCOM == 185
	CALL ROOM_SMELL_CHARA_SUB(人物_あなた, ASSI, ROOM_SMELL_VALUE(CFLAG:ASSI:角色的气味_自己的气味), ROOM_SMELL_BIT(CFLAG:ASSI:角色的气味_自己的气味))
	CALL ROOM_SMELL_CHARA_SUB(ASSI, 人物_あなた, ROOM_SMELL_VALUE(CFLAG:人物_あなた:角色的气味_自己的气味), ROOM_SMELL_BIT(CFLAG:人物_あなた:角色的气味_自己的气味))

	LOCAL:11 = 0
	LOCAL:12 = 0
	IF PALAM:人物_あなた:润滑 > PALAMLV:3 && HAS_VAGINA(人物_あなた)
		SETBIT LOCAL:12, 气味类型B_愛液
		LOCAL:11 = においの強さ_愛液_ぐっしょり
	ELSEIF PALAM:人物_あなた:润滑 > PALAMLV:1 && HAS_VAGINA(人物_あなた)
		SETBIT LOCAL:12, 气味类型B_愛液
		LOCAL:11 = においの強さ_愛液_しっとり
	ENDIF
	IF HAS_PENIS(人物_あなた)
		IF GETBIT(STAIN:人物_あなた:部位_Ｐ, 汚れB_精液)
			IF MAXBASE:人物_あなた:精力 > BASE:人物_あなた:精力
				SETBIT LOCAL:12, 气味类型B_精液
				SIF LOCAL:11 < においの強さ_精液_少量
					LOCAL:11 = においの強さ_精液_少量
			ENDIF
		ENDIF
	ENDIF
	CALL ROOM_SMELL_CHARA_SUB(ASSI, 人物_あなた, LOCAL:11, LOCAL:12)

	LOCAL:11 = 0
	LOCAL:12 = 0
	IF PALAM:ASSI:润滑 > PALAMLV:3 && HAS_VAGINA(ASSI)
		SETBIT LOCAL:12, 气味类型B_愛液
		LOCAL:11 = においの強さ_愛液_ぐっしょり
	ELSEIF PALAM:ASSI:润滑 > PALAMLV:1 && HAS_VAGINA(ASSI)
		SETBIT LOCAL:12, 气味类型B_愛液
		LOCAL:11 = においの強さ_愛液_しっとり
	ENDIF
	IF HAS_PENIS(ASSI)
		IF GETBIT(STAIN:ASSI:部位_Ｐ, 汚れB_精液)
			IF MAXBASE:ASSI:精力 > BASE:ASSI:精力
				SETBIT LOCAL:12, 气味类型B_精液
				SIF LOCAL:11 < においの強さ_精液_少量
					LOCAL:11 = においの強さ_精液_少量
			ENDIF
		ENDIF
	ENDIF
	CALL ROOM_SMELL_CHARA_SUB(人物_あなた, ASSI, LOCAL:11, LOCAL:12)
ELSEIF SELECTCOM == 411
	FOR LOOP_CHARA, 0, CHARANUM
		SIF CFLAG:MASTER:当前位置 == CFLAG:LOOP_CHARA:当前位置
			SETBIT CFLAG:LOOP_CHARA:角色的气味_自己的气味, 气味类型B_汗
	NEXT
ELSEIF SELECTCOM == 413
	SETBIT CFLAG:MASTER:角色的气味_自己的气味, 气味类型B_食物
ELSEIF SELECTCOM == 414 || SELECTCOM == 415
	CLEARBIT CFLAG:MASTER:角色的气味_自己的气味, 气味类型B_食物
ENDIF
IF ASSI && (SELECTCOM == 71 || SELECTCOM == 72 || SELECTCOM == 510)
	CALL ROOM_SMELL_CHARA_SUB(ASSI, TARGET, ROOM_SMELL_VALUE(CFLAG:TARGET:角色的气味_自己的气味), ROOM_SMELL_BIT(CFLAG:TARGET:角色的气味_自己的气味))
	CALL ROOM_SMELL_CHARA_SUB(TARGET, ASSI, ROOM_SMELL_VALUE(CFLAG:ASSI:角色的气味_自己的气味), ROOM_SMELL_BIT(CFLAG:ASSI:角色的气味_自己的气味))

	LOCAL:11 = 0
	LOCAL:12 = 0
	IF PALAM:ASSI:润滑 > PALAMLV:3 && HAS_VAGINA(ASSI)
		SETBIT LOCAL:12, 气味类型B_愛液
		LOCAL:11 = においの強さ_愛液_ぐっしょり
	ELSEIF PALAM:ASSI:润滑 > PALAMLV:1 && HAS_VAGINA(ASSI)
		SETBIT LOCAL:12, 气味类型B_愛液
		LOCAL:11 = においの強さ_愛液_しっとり
	ENDIF
	IF HAS_PENIS(ASSI)
		IF GETBIT(STAIN:ASSI:部位_Ｐ, 汚れB_精液)
			IF MAXBASE:ASSI:精力 > BASE:ASSI:精力
				SETBIT LOCAL:12, 气味类型B_精液
				SIF LOCAL:11 < においの強さ_精液_少量
					LOCAL:11 = においの強さ_精液_少量
			ENDIF
		ENDIF
	ENDIF
	CALL ROOM_SMELL_CHARA_SUB(TARGET, ASSI, LOCAL:11, LOCAL:12)

	LOCAL:11 = 0
	LOCAL:12 = 0
	IF PALAM:TARGET:润滑 > PALAMLV:3 && HAS_VAGINA(TARGET)
		SETBIT LOCAL:12, 气味类型B_愛液
		LOCAL:11 = においの強さ_愛液_ぐっしょり
	ELSEIF PALAM:TARGET:润滑 > PALAMLV:1 && HAS_VAGINA(TARGET)
		SETBIT LOCAL:12, 气味类型B_愛液
		LOCAL:11 = においの強さ_愛液_しっとり
	ENDIF
	IF HAS_PENIS(TARGET)
		IF GETBIT(STAIN:TARGET:部位_Ｐ, 汚れB_精液)
			IF MAXBASE:TARGET:精力 > BASE:TARGET:精力
				SETBIT LOCAL:12, 气味类型B_精液
				SIF LOCAL:11 < においの強さ_精液_少量
					LOCAL:11 = においの強さ_精液_少量
			ENDIF
		ENDIF
	ENDIF
	CALL ROOM_SMELL_CHARA_SUB(ASSI, TARGET, LOCAL:11, LOCAL:12)
ENDIF

;訪問者と女あなた関連の処理
IF FLAG:1840 >= 3 && FLAG:1840 < 9 || FLAG:1840 == 601 || FLAG:1840 == 10
	IF ROOM_SMELL_WHOSE(FLAG:訪問者の他人のにおい) != 人物_訪問者 && ROOM_SMELL_VALUE(FLAG:訪問者の他人のにおい) > においの強さ_精液_大量
		CALL ROOM_SMELL_CHARA_SUB(人物_あなた, ROOM_SMELL_WHOSE(FLAG:訪問者の他人のにおい), ROOM_SMELL_VALUE(FLAG:訪問者の他人のにおい) / 3, ROOM_SMELL_BIT(FLAG:訪問者の他人のにおい))
	ELSE
		CALL ROOM_SMELL_CHARA_SUB(人物_あなた, 人物_訪問者, においの強さ_精液_大量, 气味类型_体臭 + 气味类型_精液)
	ENDIF
	LOCAL:10 = ROOM_SMELL_CHARA_MOST(人物_あなた)
	CALL ROOM_SMELL_VISITER_SUB(ROOM_SMELL_WHOSE(LOCAL:10), ROOM_SMELL_VALUE(LOCAL:10), ROOM_SMELL_BIT(LOCAL:10))
ENDIF

;汚い部屋はゴミの臭いが再発生
FOR LOOP_ROOM, 1, 場所番号最大値 + 1
	SELECTCASE FLAG:(100 + LOOP_ROOM)
			;中以下はゴミの臭いが発生しない
		CASE IS < 2000
			LOCAL:10 = 0
			;やや低
		CASE IS < 3500
			CALL ROOM_SMELL_ROOM_SUB(LOOP_ROOM,0,10,气味类型_ゴミ)
			;低
		CASE IS < 5000
			CALL ROOM_SMELL_ROOM_SUB(LOOP_ROOM,0,20,气味类型_ゴミ)
			;ゴミの山
		CASEELSE
			CALL ROOM_SMELL_ROOM_SUB(LOOP_ROOM,0,45,气味类型_ゴミ)
	ENDSELECT

	;各キャラの自他全てのにおいから一番強いにおいが部屋に移る
	FOR LOOP_CHARA, 0, CHARANUM
		IF CFLAG:LOOP_CHARA:当前位置 == LOOP_ROOM
			LOCAL:10 = ROOM_SMELL_WHOSE(ROOM_SMELL_CHARA_MOST(LOOP_CHARA))
			LOCAL:11 = ROOM_SMELL_VALUE(ROOM_SMELL_CHARA_MOST(LOOP_CHARA))
			LOCAL:12 = ROOM_SMELL_BIT(ROOM_SMELL_CHARA_MOST(LOOP_CHARA))
			;PRINTFORML キャラのにおい移动処理：{LOOP_ROOM}, {LOOP_CHARA}, %GETPLACENAME(LOOP_ROOM)%, {LOOP_ROOM}, 「%ROOM_SMELL_WHOSE_NAME(LOCAL:10)%{LOCAL:10}」, {LOCAL:11}, {LOCAL:12}
			CALL ROOM_SMELL_ROOM_SUB(LOOP_ROOM,LOCAL:10,LOCAL:11,LOCAL:12)
		ENDIF
	NEXT
NEXT

;;強い部屋のにおいは1/3キャラに移る
;FOR LOOP_CHARA, 0, CHARANUM
;	LOCAL:20 = CFLAG:LOOP_CHARA:当前位置
;	LOCAL:11 = ROOM_SMELL_VALUE(FLAG:(部屋のにおい_初期FLAG + LOCAL:20)) / 3
;	IF LOCAL:11 >= 50
;		LOCAL:10 = ROOM_SMELL_WHOSE(FLAG:(部屋のにおい_初期FLAG + LOCAL:20))
;		LOCAL:12 = ROOM_SMELL_BIT(FLAG:(部屋のにおい_初期FLAG + LOCAL:20))
;		CALL ROOM_SMELL_CHARA_SUB(LOOP_CHARA, LOCAL:10, LOCAL:11, LOCAL:12)
;	ENDIF
;	LOCAL:11 = ROOM_SMELL_VALUE(FLAG:(部屋のにおい_初期FLAG_2 + LOCAL:20))
;	IF LOCAL:11 >= 50
;		LOCAL:10 = ROOM_SMELL_WHOSE(FLAG:(部屋のにおい_初期FLAG_2 + LOCAL:20))
;		LOCAL:12 = ROOM_SMELL_BIT(FLAG:(部屋のにおい_初期FLAG_2 + LOCAL:20))
;		CALL ROOM_SMELL_CHARA_SUB(LOOP_CHARA, LOCAL:10, LOCAL:11, LOCAL:12)
;	ENDIF
;NEXT
RETURN 0



@ROOM_SMELL_VENTILATION(LOCAL:0,LOCAL:1,LOCAL:2,LOCAL:5)
#DIM LOOP_ROOM

FLAG:(LOCAL:1) = TIME
FOR LOOP_ROOM, 1, 場所番号最大値 + 1
	CALL ROOM_SMELL_ROOM_MINUS(LOOP_ROOM,LOCAL:0,LOCAL:1,LOCAL:5)
NEXT

RETURN 0


@ROOM_SMELL_ROOM_MINUS(ARG,LOCAL:0,LOCAL:1,LOCAL:10)
;ARG		部屋番号
;LOCAL:10	減算値(正の値だと引かれる)
;LOCAL:11	においの強さ

LOCAL:11 = FLAG:(LOCAL:0 + ARG) % 10000000 / 100000 - LOCAL:10
SELECTCASE LOCAL:11
	CASE IS < 0
		LOCAL:11 = 0
	CASE IS > 99
		LOCAL:11 = 99
ENDSELECT

IF LOCAL:11 == 0
	FLAG:(LOCAL:0 + ARG) = 0
ELSE
	FLAG:(LOCAL:0 + ARG) = FLAG:(LOCAL:0 + ARG) / 10000000 * 10000000 + LOCAL:11 * 100000 + FLAG:(LOCAL:0 + ARG) % 100000
ENDIF

LOCAL:11 = FLAG:(LOCAL:1 + ARG) % 10000000 / 100000 - LOCAL:10
SELECTCASE LOCAL:11
	CASE IS < 0
		LOCAL:11 = 0
	CASE IS > 99
		LOCAL:11 = 99
ENDSELECT

IF LOCAL:11 == 0
	FLAG:(LOCAL:1 + ARG) = 0
ELSE
	FLAG:(LOCAL:1 + ARG) = FLAG:(LOCAL:1 + ARG) / 10000000 * 10000000 + LOCAL:11 * 100000 + FLAG:(LOCAL:1 + ARG) % 100000
ENDIF

RETURN 0


@ROOM_SMELL_BIT(LOCAL:10)
#FUNCTION
LOCAL:10 = LOCAL:10 % 100000
RETURNF LOCAL:10

@ROOM_SMELL_VALUE(LOCAL:10)
#FUNCTION
LOCAL:10 = LOCAL:10 % 10000000 / 100000
RETURNF LOCAL:10

@ROOM_SMELL_WHOSE(LOCAL:10)
#FUNCTION
LOCAL:10 = (LOCAL:10) / 10000000
RETURNF LOCAL:10

@ROOM_SMELL_WHOSE_NAME(LOCAL:10)
#FUNCTIONS
SIF ROOM_SMELL_BIT(LOCAL:10) == 0 || ROOM_SMELL_VALUE(LOCAL:10) == 0
	RETURNF "無臭"
SIF ROOM_SMELL_BIT(LOCAL:10) == 1
	RETURNF "ゴミ"
LOCAL:10 = LOCAL:10 / 10000000
IF LOCAL:10 < CHARANUM
	RETURNF CALLNAME:(LOCAL:10)
ELSEIF LOCAL:10 == 精子主_訪問者 || LOCAL:10 == 人物_訪問者
	RETURNF NTR_NAME(0)
ELSEIF LOCAL:10 == 精子主_村人 || LOCAL:10 == 人物_村人
	RETURNF "村人"
ELSEIF LOCAL:10 == 精子主_客 || LOCAL:10 == 人物_客
	RETURNF "客"
ELSE
	RETURNF "名称エラー" + ToSTR(LOCAL:10)
ENDIF

@ROOM_SMELL_KINDS(LOCAL:10)
#FUNCTIONS
#DIM LOOP_1
#DIMS 气味类型
LOCAL:10 = ROOM_SMELL_BIT(LOCAL:10)
LOCAL:11 = 0
气味类型 = %""%
IF GETBIT(FLAG:部屋のにおい_初期FLAG, 1)
	FOR LOOP_1, 0, 气味类型数最大値
		IF GETBIT(LOCAL:10, LOOP_1)
			SIF LOCAL:11 != 0
				气味类型 = %气味类型%和
			SELECTCASE LOOP_1
				CASE IS == 0
					气味类型 = 垃圾
					RETURNF 气味类型
				CASE IS == 1
					气味类型 = %气味类型%汗液
				CASE IS == 2
					气味类型 = %气味类型%体委
				CASE IS == 3
					气味类型 = %气味类型%愛液
				CASE IS == 4
					气味类型 = %气味类型%精液
				CASE IS == 5
					气味类型 = %气味类型%食物
			ENDSELECT
			LOCAL:11++
		ENDIF
	NEXT
ELSE
	IF GETBIT(LOCAL:10, 气味类型B_愛液) || GETBIT(LOCAL:10, 气味类型B_精液)
		IF GETBIT(LOCAL:10, 气味类型B_愛液)
			气味类型 = %气味类型%愛液
			LOCAL:11++
		ENDIF
		IF GETBIT(LOCAL:10, 气味类型B_精液)
			SIF LOCAL:11
				气味类型 = %气味类型%和
			气味类型 = %气味类型%精液
		ENDIF
	ELSE
		FOR LOOP_1, 0, 气味类型数最大値
			IF GETBIT(LOCAL:10, LOOP_1)
				SIF LOCAL:11 != 0
					气味类型 = %气味类型%和
				SELECTCASE LOOP_1
					CASE IS == 0
						气味类型 = 垃圾
						RETURNF 气味类型
					CASE IS == 1
						气味类型 = %气味类型%汗液
					CASE IS == 2
						气味类型 = %气味类型%体味
					CASE IS == 5
						气味类型 = %气味类型%食物
				ENDSELECT
				LOCAL:11++
			ENDIF
		NEXT
	ENDIF
ENDIF

RETURNF 气味类型

;ARG で指定したキャラの一番強いにおいを取得
@ROOM_SMELL_CHARA_MOST(ARG)
#FUNCTION
#DIM LOOP_I
LOCAL:10 = 1
FOR LOOP_I, 1, 5
	IF ROOM_SMELL_VALUE(CFLAG:ARG:(角色的气味_初期CFLAG + LOOP_I)) > ROOM_SMELL_VALUE(CFLAG:ARG:(角色的气味_初期CFLAG + LOCAL:10))
		LOCAL:10 = LOOP_I
	ELSEIF ROOM_SMELL_VALUE(CFLAG:ARG:(角色的气味_初期CFLAG + LOOP_I)) == ROOM_SMELL_VALUE(CFLAG:ARG:(角色的气味_初期CFLAG + LOCAL:10))
		SIF GETBIT(ROOM_SMELL_BIT(CFLAG:ARG:(角色的气味_初期CFLAG + LOOP_I)), 气味类型B_精液)
			LOCAL:10 = LOOP_I
	ENDIF
NEXT
RETURNF CFLAG:ARG:(角色的气味_初期CFLAG + LOCAL:10)

;ARG で指定したキャラのにおいを作成
@ROOM_SMELL_CHARA_SMELL_CREATE(ARG)
;ARG		キャラ番号
;LOCAL:11	においの強さ
;LOCAL:12	气味类型

;PRINTFORML {ARG}, {CFLAG:ARG:角色的气味_自己的气味}
LOCAL:11 = ROOM_SMELL_VALUE(CFLAG:ARG:角色的气味_自己的气味)
LOCAL:12 = ROOM_SMELL_BIT(CFLAG:ARG:角色的气味_自己的气味)
;PRINTFORML {ARG}, {LOCAL:11}, {LOCAL:12}

IF CFLAG:ARG:角色的气味_初期CFLAG
	SETBIT LOCAL:12, 气味类型B_体臭
	SIF LOCAL:11 < CFLAG:ARG:角色的气味_初期CFLAG
		LOCAL:11 = CFLAG:ARG:角色的气味_初期CFLAG
ELSE
	CLEARBIT LOCAL:12, 气味类型B_体臭
ENDIF
;PRINTFORML {ARG}, {LOCAL:11}, {LOCAL:12}

IF PALAM:ARG:润滑 > PALAMLV:3 && HAS_VAGINA(ARG)
	SETBIT LOCAL:12, 气味类型B_愛液
	SIF LOCAL:11 < においの強さ_愛液_ぐっしょり
		LOCAL:11 = においの強さ_愛液_ぐっしょり
ELSEIF PALAM:ARG:润滑 > PALAMLV:1 && HAS_VAGINA(ARG)
	SETBIT LOCAL:12, 气味类型B_愛液
	SIF LOCAL:11 < においの強さ_愛液_しっとり
		LOCAL:11 = においの強さ_愛液_しっとり
ELSE
	CLEARBIT LOCAL:12, 气味类型B_愛液
ENDIF
;PRINTFORML {ARG}, {LOCAL:11}, {LOCAL:12}

IF HAS_PENIS(ARG)
	IF GETBIT(STAIN:ARG:部位_Ｐ, 汚れB_精液)
		IF MAXBASE:ARG:精力 > BASE:ARG:精力
			SETBIT LOCAL:12, 气味类型B_精液
			SIF LOCAL:11 < においの強さ_精液_少量
				LOCAL:11 = においの強さ_精液_少量
		ENDIF
	ENDIF
ELSE
	CLEARBIT LOCAL:12, 气味类型B_精液
ENDIF
;PRINTFORML {ARG}, {LOCAL:11}, {LOCAL:12}

CFLAG:ARG:角色的气味_自己的气味 = ARG * 10000000 + LOCAL:11 * 100000 + LOCAL:12
;PRINTFORML {ARG}, {CFLAG:ARG:角色的气味_自己的气味}

RETURN 0


;におい情報の代入
@ROOM_SMELL_CHARA_SUB(ARG,LOCAL:10,LOCAL:11,LOCAL:12)
;ARG		キャラ番号
;LOCAL:10	誰のにおいか
;LOCAL:11	においの強さ
;LOCAL:12	气味类型
;LOCAL:13	一時変数
#DIM LOOP_1
#DIM LOOP_2

SIF LOCAL:11 > 99
	LOCAL:11 = 99
SIF LOCAL:11 < 0
	LOCAL:11 = 0
SIF LOCAL:12 >= 65536
	LOCAL:12 = 65535
SIF LOCAL:12 < 0
	LOCAL:12 = 0
IF LOCAL:11 == 0 || LOCAL:12 == 0
	LOCAL:11 = 0
	LOCAL:12 = 0
ENDIF
;PRINTFORML {LOCAL:10 * 10000000 + LOCAL:11 * 100000 + LOCAL:12}
;PRINTFORML キャラへの代入：行き先%ROOM_SMELL_WHOSE_NAME(ARG * 10000000+1111111)%{ARG}, {LOCAL:10}, {LOCAL:11}, {LOCAL:12}
IF LOCAL:10 == ARG
	FOR LOOP_1, 0, 气味类型数最大値
		SIF GETBIT(ROOM_SMELL_BIT(CFLAG:ARG:角色的气味_自己的气味), 气味类型B_ゴミ + LOOP_1)
			SETBIT LOCAL:12, LOOP_1
	NEXT
	SIF ROOM_SMELL_VALUE(CFLAG:ARG:角色的气味_自己的气味) > LOCAL:11
		LOCAL:11 = ROOM_SMELL_VALUE(CFLAG:ARG:角色的气味_自己的气味)
	CFLAG:ARG:角色的气味_自己的气味 = LOCAL:10 * 10000000 + LOCAL:11 * 100000 + LOCAL:12
ELSE
	LOCAL:13 = 0
	FOR LOOP_1, 0, 3
		IF ROOM_SMELL_WHOSE(CFLAG:ARG:(角色的气味_别人的气味_1 + LOOP_1)) == LOCAL:10
			FOR LOOP_2, 0, 气味类型数最大値
				SIF GETBIT(ROOM_SMELL_BIT(CFLAG:ARG:(角色的气味_别人的气味_1 + LOOP_1)), 气味类型B_ゴミ + LOOP_2)
					SETBIT LOCAL:12, 气味类型B_ゴミ + LOOP_2
			NEXT
			SIF ROOM_SMELL_VALUE(CFLAG:ARG:(角色的气味_别人的气味_1 + LOOP_1)) > LOCAL:11
				LOCAL:11 = ROOM_SMELL_VALUE(CFLAG:ARG:(角色的气味_别人的气味_1 + LOOP_1))
			SIF GETBIT(ROOM_SMELL_BIT(CFLAG:ARG:(角色的气味_别人的气味_1 + LOOP_1)), 气味类型B_精液) && GETBIT(LOCAL:12, 气味类型B_精液) && (TCVAR:ARG:102 || TCVAR:ARG:104) && (TCVAR:ARG:103 == LOCAL:10 || TCVAR:ARG:105 == LOCAL:10)
				LOCAL:11 += 5
			SIF LOCAL:11 > 99
				LOCAL:11 = 99
			CFLAG:ARG:(角色的气味_别人的气味_1 + LOOP_1) = LOCAL:10 * 10000000 + LOCAL:11 * 100000 + LOCAL:12
			RETURN 0
		ELSE
			SIF ROOM_SMELL_VALUE(CFLAG:ARG:(角色的气味_别人的气味_1 + LOOP_1)) < LOCAL:11
				LOCAL:13 = LOOP_1
		ENDIF
	NEXT
	CLEARBIT LOCAL:12, 气味类型_ゴミ
	SIF ROOM_SMELL_VALUE(CFLAG:ARG:(角色的气味_别人的气味_1 + LOCAL:13)) < LOCAL:11
		CFLAG:ARG:(角色的气味_别人的气味_1 + LOCAL:13) = LOCAL:10 * 10000000 + LOCAL:11 * 100000 + LOCAL:12
ENDIF
RETURN 0

;におい情報の代入
@ROOM_SMELL_ROOM_SUB(ARG,LOCAL:10,LOCAL:11,LOCAL:12)
;ARG		部屋番号
;LOCAL:10	誰のにおいか
;LOCAL:11	においの強さ
;LOCAL:12	气味类型
;LOCAL:13	一時変数
#DIM LOOP_I

SIF ARG > 場所番号最大値
	RETURN 0
SIF LOCAL:11 > 99
	LOCAL:11 = 99
SIF LOCAL:11 < 0
	LOCAL:11 = 0
SIF LOCAL:12 >= 65536
	LOCAL:12 = 65535
SIF LOCAL:12 < 0
	LOCAL:12 = 0
LOCAL:13 = LOCAL:10 * 10000000 + LOCAL:11 * 100000 + LOCAL:12
;PRINTFORMW 代入処理：%GETPLACENAME(ARG)%, {ARG}, %CALLNAME:(LOCAL:10)%, {LOCAL:11}, {LOCAL:12}, {LOCAL:13}, {ROOM_SMELL_WHOSE(LOCAL:13)}
IF ROOM_SMELL_WHOSE(FLAG:(部屋のにおい_初期FLAG + ARG)) == ROOM_SMELL_WHOSE(LOCAL:13) && ROOM_SMELL_BIT(FLAG:(部屋のにおい_初期FLAG + ARG)) != 气味类型_ゴミ
	FOR LOOP_I, 0, 气味类型数最大値
		SIF GETBIT(ROOM_SMELL_BIT(LOCAL:13), 气味类型_ゴミ + LOOP_I)
			SETBIT LOCAL:12, 气味类型_ゴミ + LOOP_I
	NEXT
	SIF ROOM_SMELL_VALUE(FLAG:(部屋のにおい_初期FLAG + ARG)) > ROOM_SMELL_VALUE(LOCAL:13)
		LOCAL:11 = ROOM_SMELL_VALUE(FLAG:(部屋のにおい_初期FLAG + ARG))
	LOCAL:13 = LOCAL:10 * 10000000 + LOCAL:11 * 100000 + LOCAL:12
	FLAG:(部屋のにおい_初期FLAG + ARG) = LOCAL:13
ELSEIF ROOM_SMELL_WHOSE(FLAG:(部屋のにおい_初期FLAG_2 + ARG)) == ROOM_SMELL_WHOSE(LOCAL:13) && ROOM_SMELL_BIT(FLAG:(部屋のにおい_初期FLAG_2 + ARG)) != 气味类型_ゴミ
	FOR LOOP_I, 0, 气味类型数最大値
		SIF GETBIT(ROOM_SMELL_BIT(LOCAL:13), 气味类型_ゴミ + LOOP_I)
			SETBIT LOCAL:12, 气味类型_ゴミ + LOOP_I
	NEXT
	SIF ROOM_SMELL_VALUE(FLAG:(部屋のにおい_初期FLAG_2 + ARG)) > ROOM_SMELL_VALUE(LOCAL:13)
		LOCAL:11 = ROOM_SMELL_VALUE(FLAG:(部屋のにおい_初期FLAG_2 + ARG))
	LOCAL:13 = LOCAL:10 * 10000000 + LOCAL:11 * 100000 + LOCAL:12
	FLAG:(部屋のにおい_初期FLAG_2 + ARG) = LOCAL:13
ELSEIF (ROOM_SMELL_VALUE(FLAG:(部屋のにおい_初期FLAG + ARG)) < ROOM_SMELL_VALUE(FLAG:(部屋のにおい_初期FLAG_2 + ARG))) && (ROOM_SMELL_VALUE(FLAG:(部屋のにおい_初期FLAG + ARG)) < ROOM_SMELL_VALUE(LOCAL:13))
	FLAG:(部屋のにおい_初期FLAG + ARG) = LOCAL:13
ELSEIF (ROOM_SMELL_VALUE(FLAG:(部屋のにおい_初期FLAG + ARG)) >= ROOM_SMELL_VALUE(FLAG:(部屋のにおい_初期FLAG_2 + ARG))) && (ROOM_SMELL_VALUE(FLAG:(部屋のにおい_初期FLAG_2 + ARG)) < ROOM_SMELL_VALUE(LOCAL:13))
	FLAG:(部屋のにおい_初期FLAG_2 + ARG) = LOCAL:13
ENDIF
RETURN 0

;におい情報の代入(訪問者専用)
@ROOM_SMELL_VISITER_SUB(LOCAL:10, LOCAL:11, LOCAL:12)
;LOCAL:10	誰のにおいか
;LOCAL:11	においの強さ
;LOCAL:12	气味类型
#DIM LOOP_1

IF ROOM_SMELL_WHOSE(FLAG:訪問者の他人のにおい) == LOCAL:10
	SIF ROOM_SMELL_VALUE(FLAG:訪問者の他人のにおい) > LOCAL:11
		LOCAL:11 = ROOM_SMELL_VALUE(FLAG:訪問者の他人のにおい)
	FOR LOOP_1, 0, 气味类型数最大値
		SIF GETBIT(ROOM_SMELL_BIT(FLAG:訪問者の他人のにおい), LOOP_1)
			SETBIT LOCAL:12, LOOP_1
	NEXT
	FLAG:訪問者の他人のにおい = LOCAL:10 * 10000000 + LOCAL:11 * 100000 + LOCAL:12
ELSEIF ROOM_SMELL_VALUE(FLAG:訪問者の他人のにおい) < LOCAL:11
	FLAG:訪問者の他人のにおい = LOCAL:10 * 10000000 + LOCAL:11 * 100000 + LOCAL:12
ENDIF
RETURN 0

@ROOM_SMELL_NTR_PET(ARG)
IF ROOM_SMELL_WHOSE(FLAG:訪問者の他人のにおい) != 人物_訪問者
	CALL ROOM_SMELL_CHARA_SUB(ARG, ROOM_SMELL_WHOSE(FLAG:訪問者の他人のにおい), ROOM_SMELL_VALUE(FLAG:訪問者の他人のにおい) / 3, ROOM_SMELL_BIT(FLAG:訪問者の他人のにおい))
	CALL ROOM_SMELL_VISITER_SUB(ROOM_SMELL_WHOSE(ROOM_SMELL_CHARA_MOST(ARG)), ROOM_SMELL_VALUE(ROOM_SMELL_CHARA_MOST(ARG)), ROOM_SMELL_BIT(ROOM_SMELL_CHARA_MOST(ARG)))
ELSE
	CALL ROOM_SMELL_CHARA_SUB(ARG, ROOM_SMELL_WHOSE(FLAG:訪問者の他人のにおい), においの強さ_訪問者の体臭, 气味类型_体臭)
	CALL ROOM_SMELL_VISITER_SUB(ROOM_SMELL_WHOSE(ROOM_SMELL_CHARA_MOST(ARG)), ROOM_SMELL_VALUE(ROOM_SMELL_CHARA_MOST(ARG)), ROOM_SMELL_BIT(ROOM_SMELL_CHARA_MOST(ARG)))
ENDIF

;オーラルとは言ってもにおいが訪問者→住人の処理という事
@ROOM_SMELL_NTR_ORAL(ARG)
IF ROOM_SMELL_WHOSE(FLAG:訪問者の他人のにおい) != 人物_訪問者
	IF ROOM_SMELL_VALUE(FLAG:訪問者の他人のにおい) > においの強さ_訪問者の体臭 * 3 / 2
		CALL ROOM_SMELL_CHARA_SUB(ARG, ROOM_SMELL_WHOSE(FLAG:訪問者の他人のにおい), ROOM_SMELL_VALUE(FLAG:訪問者の他人のにおい) / 3, ROOM_SMELL_BIT(FLAG:訪問者の他人のにおい))
	ELSE
		CALL ROOM_SMELL_CHARA_SUB(ARG, ROOM_SMELL_WHOSE(FLAG:訪問者の他人のにおい), においの強さ_訪問者の体臭 * 3 / 2, ROOM_SMELL_BIT(FLAG:訪問者の他人のにおい))
	ENDIF
ELSE
	;体臭に準拠し, 阴茎のにおいの強さ(1.5倍)
	CALL ROOM_SMELL_CHARA_SUB(ARG, ROOM_SMELL_WHOSE(FLAG:訪問者の他人のにおい), においの強さ_訪問者の体臭 * 3 / 2, ROOM_SMELL_BIT(FLAG:訪問者の他人のにおい))
ENDIF

;セックスだけでなく素股等もこちら
@ROOM_SMELL_NTR_SEX(ARG)
IF ROOM_SMELL_WHOSE(FLAG:訪問者の他人のにおい) != 人物_訪問者
	IF ROOM_SMELL_VALUE(FLAG:訪問者の他人のにおい) > においの強さ_訪問者の体臭 * 3 / 2
		CALL ROOM_SMELL_CHARA_SUB(ARG, ROOM_SMELL_WHOSE(FLAG:訪問者の他人のにおい), ROOM_SMELL_VALUE(FLAG:訪問者の他人のにおい) / 3, ROOM_SMELL_BIT(FLAG:訪問者の他人のにおい))
	ELSE
		CALL ROOM_SMELL_CHARA_SUB(ARG, ROOM_SMELL_WHOSE(FLAG:訪問者の他人のにおい), においの強さ_訪問者の体臭 * 3 / 2, ROOM_SMELL_BIT(FLAG:訪問者の他人のにおい))
	ENDIF
	CALL ROOM_SMELL_VISITER_SUB(ROOM_SMELL_WHOSE(ROOM_SMELL_CHARA_MOST(ARG)), ROOM_SMELL_VALUE(ROOM_SMELL_CHARA_MOST(ARG)), ROOM_SMELL_BIT(ROOM_SMELL_CHARA_MOST(ARG)))
ELSE
	CALL ROOM_SMELL_CHARA_SUB(ARG, ROOM_SMELL_WHOSE(FLAG:訪問者の他人のにおい), においの強さ_訪問者の体臭 * 3 / 2, ROOM_SMELL_BIT(FLAG:訪問者の他人のにおい))
	CALL ROOM_SMELL_VISITER_SUB(ROOM_SMELL_WHOSE(ROOM_SMELL_CHARA_MOST(ARG)), ROOM_SMELL_VALUE(ROOM_SMELL_CHARA_MOST(ARG)), ROOM_SMELL_BIT(ROOM_SMELL_CHARA_MOST(ARG)))
ENDIF

@ROOM_SMELL_WHOSE_SAMEN(対象者)
#FUNCTION
#DIM 対象者
#DIM LOOP_CHARA
#DIM 精子量

精子量 = 0
LOCAL:10 = -1
LOCAL:11 = 0
FOR LOOP_CHARA, 0, 301
	SIF LOOP_CHARA == CHARANUM
		LOOP_CHARA = 精子主_スキップ
	DA:対象者:LOOP_CHARA = 0
	REPEAT 9
		DA:対象者:LOOP_CHARA += TA:対象者:LOOP_CHARA:COUNT
	REND

	IF DA:対象者:LOOP_CHARA > 0
		;PRINTFORML {LOOP_CHARA}, {DA:対象者:LOOP_CHARA}
		SIF LOCAL:10 == -1
			LOCAL:10 = LOOP_CHARA
		LOCAL:11 = 0
		REPEAT 9
			LOCAL:11 += TA:対象者:(LOCAL:10):COUNT
		REND
		SIF DA:対象者:LOOP_CHARA > LOCAL:11
			LOCAL:10 = LOOP_CHARA
	ENDIF
NEXT
SIF LOCAL:10 == -1
	RETURNF 0
RETURNF LOCAL:10

