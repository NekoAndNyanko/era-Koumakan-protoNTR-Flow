@SHOW_SHOP
TRYCALL COM461_PUNISHMENT_END
TRYCALL 追加パッチVerUP
FOR LOCAL , 0 , CHARANUM
	CALL 肌肤等颜色改变(LOCAL)
	SIF LOCAL != 0
		CALL 计算最大体气等值(LOCAL)
NEXT
FOR LOCAL, 1, CHARANUM
	IF CFLAG:LOCAL:現在位置 != 位置_訪問者宅
		IF TALENT:LOCAL:浮気公認 < 5
			CALL NTR_SET_STAYOUT_MAXIMUM(LOCAL, LIMIT(CFLAG:LOCAL:屈服度 /(CFLAG:LOCAL:好感度+1),0,7))
		ELSE
			CALL NTR_SET_STAYOUT_MAXIMUM(LOCAL, LIMIT(RAND(14,31),14,30))
		ENDIF
	ENDIF
NEXT
;奴隷購入ページフラグ
TFLAG:100 = 0
DRAWLINE
PRINTFORML %日付_月(暦法月)%{暦法日}日[{DAY}日目](%GET_DAY()%)
PRINTFORML (所持金:{MONEY} 元)
PRINT 体力:
BAR BASE:MASTER:0,MAXBASE:MASTER:0,16
PRINTFORM ({BASE:MASTER:0,4}/{MAXBASE:MASTER:0,4}) 
PRINT 气力:
BAR BASE:MASTER:1,MAXBASE:MASTER:1,16
PRINTFORM ({BASE:MASTER:1,4}/{MAXBASE:MASTER:1,4})
PRINTL

PRINTL [100] - 起床
PRINTL [101] - 能力表示
SIF STRLENS(SAVESTR:10) > 1
	PRINTL [102] - 查看自己取得的收藏
PRINTL [105] - 查看从妖精女仆那取得的收藏
PRINTL [103] - 通信販売
PRINTL [104] - 設定
PRINTL [200] - SAVE
PRINTL [300] - LOAD
PRINTL [400] - OPTION
PRINTL ----------------
;PRINTL [500] - 扶她起来
;PRINTFORML [501]真实模式（\@ GETBIT(FLAG:真实模式,0) ?ON#OFF\@）
TRYCALL 妊娠パッチDEBUG88

@USERSHOP

TRYCALL 妊娠パッチDEBUG88COM

IF RESULT == 100
	BEGIN TRAIN
	RETURN 1
ELSEIF RESULT == 101
	CALL SHOW_CHARADATA
ELSEIF RESULT == 102 && STRLENS(SAVESTR:10) > 1
	CALL SHOW_COLLECTION
ELSEIF RESULT == 103
	CALL ITEM_BUY
ELSEIF RESULT == 104
	CALL SCHEDULE
ELSEIF RESULT == 105
	CALL 查看从妖精女仆那取得的收藏
ELSEIF RESULT == 200
	SAVEGAME
ELSEIF RESULT == 300
	LOADGAME
ELSEIF RESULT == 400
	CALL OPTION
[SKIPSTART]
ELSEIF RESULT == 500
	CALL SET_FUTANARI_ALL
ELSEIF RESULT == 501
	FLAG:真实模式 = FLAG:真实模式 ? 0 # 1
[SKIPEND]
	;ELSEIF RESULT == 998
	;	CALL DEBUG_MODE_2
	;ELSEIF RESULT == 9998
	;	CALL DEBUG_MODE
ELSEIF RESULT == 9988
	CALL DEBUG_Maid
ENDIF


@SCHEDULE
#DIM LOOP_CHR

PRINTFORML [0] - 起床時間設定　　現在の設定：{CFLAG:MASTER:通常起床時間 / 60, 3}時
SIF FLAG:陥落人数
	PRINTFORML [1] - 私室設定　　　　現在の設定：%GETPLACENAME(CFLAG:MASTER:開始位置)%
PRINTFORML [2] - %NTR_NAME(0)%状态设定
PRINTFORML [3] - 孩子的呼叫
PRINTL [100] - 返回
INPUT
IF RESULT == 100
	RETURN 0
ELSEIF RESULT == 0
	LOCAL = CFLAG:MASTER:通常起床時間 / 60 + 1000
	$INPUT_LOOP
	PRINTFORML 今天的起床时间是{LOCAL - 1000, 3}时
	PRINTL 什么时候起床？
	PRINTBUTTON "[－]", (LOCAL == 1000 ? 1023 # LOCAL - 1)
	PRINTBUTTON "[＋]", (LOCAL == 1023 ? 1000 # LOCAL + 1)
	PRINTL 
	PRINTL [100] - 設定完了
	INPUT
	IF RESULT == 100
		CFLAG:MASTER:通常起床時間 = (LOCAL - 1000) * 60
	ELSEIF RESULT >= 0 && RESULT < 24
		CFLAG:MASTER:通常起床時間 = RESULT * 60
	ELSE
		SIF RESULT >= 1000 && RESULT < 1024
			LOCAL = RESULT
		CLEARLINE 5
		GOTO INPUT_LOOP
	ENDIF
	RESTART
ELSEIF RESULT == 1 && FLAG:陥落人数
	PRINTL 可以改变睡觉的房间
	PRINTL [0] - 自己的房间
	FOR LOOP_CHR,1,CHARANUM
		SIF TALENT:LOOP_CHR:恋慕
			PRINTFORML [{LOOP_CHR,3}] - %CALLNAME:LOOP_CHR%の部屋
	NEXT
	$INPUT_LOOP2
	INPUT

	IF RESULT < 0 || RESULT >= CHARANUM
		CLEARLINE 1
		GOTO INPUT_LOOP2
	ELSEIF RESULT == 0
		CFLAG:MASTER:開始位置 = 15
	ELSEIF TALENT:RESULT:恋慕
		CFLAG:MASTER:開始位置 = CFLAG:RESULT:311
	ELSE
		CLEARLINE 1
		GOTO INPUT_LOOP2
	ENDIF
	PRINTW 改变从第二天生效
	RESTART
ELSEIF RESULT == 2
	CALL MAN_SET
	RESTART
ELSEIF RESULT == 3
	CALL 子供訪問_設定
	RESTART
ENDIF

RETURN 1

@SET_FUTANARI_ALL
#DIM LOOP_CHR
#DIM IS_TARGET_CHILD
#DIM FUTA

$INPUT_LOOP
PRINTL [100] - 返回
PRINTL [101] - 女儿 变扶她 0%
PRINTL [102] - 女儿 变扶她 50%
PRINTL [103] - 女儿 变扶她 100%
PRINTL [104] - 初期人物 变扶她 0%
PRINTL [105] - 初期人物 变扶她 50%
PRINTL [106] - 初期人物 变扶她 100%

INPUT
IF RESULT == 100
	RETURN 1
ELSEIF RESULT >= 101 && RESULT <= 106
	IF RESULT >= 101 && RESULT <= 103
		IS_TARGET_CHILD = 1
	ELSE
		IS_TARGET_CHILD = 0
	ENDIF
	FOR LOOP_CHR,0,CHARANUM
		SIF LOOP_CHR == MASTER
			CONTINUE
		IF CHILDREM_CHECK(LOOP_CHR)
			SIF IS_TARGET_CHILD == 0
				CONTINUE
		ELSE
			SIF IS_TARGET_CHILD != 0
				CONTINUE
		ENDIF
		SIF TALENT:LOOP_CHR:2 == 2
			CONTINUE
		IF RESULT == 101 || RESULT == 104
			FUTA = 0
		ELSEIF RESULT == 102 || RESULT == 105
			FUTA = RAND:2
		ELSE
			FUTA = 1
		ENDIF
		; 生やしたり消したりする処理はSHOP_ITEM.ERBからコピペ＆改変
		IF FUTA == 0 && TALENT:LOOP_CHR:2 == 3
			TALENT:LOOP_CHR:2 = 1
			MAXBASE:LOOP_CHR:2 = 0
			MAXBASE:LOOP_CHR:精力 = 0
		ELSEIF FUTA != 0 && TALENT:LOOP_CHR:2 == 1
			TALENT:LOOP_CHR:2 |= 2
			MAXBASE:LOOP_CHR:射精 = 10000
			IF MAXBASE:LOOP_CHR:精力 > 0
				MAXBASE:LOOP_CHR:精力 = LIMIT(MAXBASE:LOOP_CHR:精力,200,1000)
			ELSE
				MAXBASE:LOOP_CHR:精力 = 1000
			ENDIF
			IF MAXBASE:LOOP_CHR:勃起 > 0
				MAXBASE:LOOP_CHR:勃起 = LIMIT(MAXBASE:LOOP_CHR:勃起,500,1500)
			ELSE
				MAXBASE:LOOP_CHR:勃起 = 1500
			ENDIF
		ENDIF
	NEXT
ENDIF

GOTO INPUT_LOOP

@人物基础体气等值(ARG,类型)
#FUNCTION
#DIMS 类型
SELECTCASE CALLNAME:ARG
	CASE "美铃"
		SELECTCASE 类型
			CASE "体力"
				RETURNF 2500
			CASE "气力"
				RETURNF 2300
		ENDSELECT
	CASE "小恶魔"
		SELECTCASE 类型
			CASE "体力"
				RETURNF 2000
			CASE "气力"
				RETURNF 1000
		ENDSELECT
	CASE "帕秋莉"
		SELECTCASE 类型
			CASE "体力"
				RETURNF 1300
			CASE "气力"
				RETURNF 2000
		ENDSELECT
	CASE "咲夜"
		SELECTCASE 类型
			CASE "体力"
				RETURNF 2000
			CASE "气力"
				RETURNF 1200
		ENDSELECT
	CASE "蕾米莉亚"
		SELECTCASE 类型
			CASE "体力"
				RETURNF 2200
			CASE "气力"
				RETURNF 1500
		ENDSELECT
	CASE "芙兰朵露"
		SELECTCASE 类型
			CASE "体力"
				RETURNF 2500
			CASE "气力"
				RETURNF 1000
		ENDSELECT
	CASE "艾丽娅"
		SELECTCASE 类型
			CASE "体力"
				RETURNF 1800
			CASE "气力"
				RETURNF 1000
		ENDSELECT
	CASE "琪露诺"
		SELECTCASE 类型
			CASE "体力"
				RETURNF 2000
			CASE "气力"
				RETURNF 1100
		ENDSELECT
	CASE "大妖精"
		SELECTCASE 类型
			CASE "体力"
				RETURNF 1900
			CASE "气力"
				RETURNF 1000
		ENDSELECT
	CASE "魔理沙"
		SELECTCASE 类型
			CASE "体力"
				RETURNF 2000
			CASE "气力"
				RETURNF 1300
		ENDSELECT
	CASE "灵梦"
		SELECTCASE 类型
			CASE "体力"
				RETURNF 2100
			CASE "气力"
				RETURNF 1400
		ENDSELECT
	CASE "露米娅"
		SELECTCASE 类型
			CASE "体力"
				RETURNF 2200
			CASE "气力"
				RETURNF 1100
		ENDSELECT
	CASE "爱丽丝"
		SELECTCASE 类型
			CASE "体力"
				RETURNF 2000
			CASE "气力"
				RETURNF 1400
		ENDSELECT
ENDSELECT
SELECTCASE 类型
	CASE "体力"
		RETURNF 2000
	CASE "气力"
		RETURNF 1500
ENDSELECT

@计算最大体气等值(ARG)
#DIM 最大值
最大值 = 人物基础体气等值(ARG,"体力")
最大值 += TALENT:ARG:淫乱 * 300
最大值 += EXP:ARG:NTR陷落经验 > 0 ? 300 # 0
最大值 += EXP:ARG:公众便所陷落经验 > 0 ? 300 # 0
最大值 += TALENT:ARG:自慰狂 * 200
最大值 += TALENT:ARG:淫壶 * 200
最大值 += TALENT:ARG:淫肛 * 200
最大值 += TALENT:ARG:淫乳 * 200
最大值 += TALENT:ARG:浮気的蜜唇 * 200
最大值 += TALENT:ARG:浮気的蜜壶 * 200
最大值 += TALENT:ARG:浮気的菊花 * 200
SIF TALENT:ARG:妊娠
	最大值 -= 500
MAXBASE:ARG:体力 = MAX(1,最大值)

最大值 = 人物基础体气等值(ARG,"气力")
最大值 += TALENT:ARG:淫乱 * 300
最大值 += EXP:ARG:NTR陷落经验 > 0 ? 300 # 0
最大值 += EXP:ARG:公众便所陷落经验 > 0 ? 300 # 0
最大值 += TALENT:ARG:自慰狂 * 100
最大值 += TALENT:ARG:淫壶 * 100
最大值 += TALENT:ARG:淫肛 * 100
最大值 += TALENT:ARG:淫乳 * 100
最大值 += TALENT:ARG:浮気的蜜唇 * 300
最大值 += TALENT:ARG:浮気的蜜壶 * 300
最大值 += TALENT:ARG:浮気的菊花 * 300
最大值 += TALENT:ARG:浮気癖 * 300
SIF TALENT:ARG:妊娠
	最大值 -= 500
MAXBASE:ARG:气力 = MAX(1,最大值)








