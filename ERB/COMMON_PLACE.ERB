;位置関係
;部屋名出力
@GETPLACENAME(場所番号,場所番号詳細)
#FUNCTIONS
#DIM 場所番号
#DIM 場所番号詳細
SELECTCASE 場所番号
	CASE 位置_红魔馆_正门
		RETURNF "红魔馆正门"
	CASE 位置_红魔馆_大厅
		RETURNF "大厅"
	CASE 位置_红魔馆_餐厅
		RETURNF "食堂"
	CASE 位置_红魔馆_大图书馆
		RETURNF "图书室"
	CASE 位置_红魔馆_厨房
		RETURNF "厨房"
	CASE 位置_红魔馆_仓库
		RETURNF "仓库"
	CASE 位置_红魔馆_帕秋莉私室
		RETURNF @"%CALLNAME:人物_帕秋莉%私室"
	CASE 位置_红魔馆_小恶魔私室
		RETURNF @"%CALLNAME:人物_小恶魔%私室"
	CASE 位置_红魔馆_守卫小屋
		RETURNF "守卫小屋"
	CASE 位置_红魔馆_后院
		RETURNF "院子"
	CASE 位置_红魔馆_二楼楼梯间
		RETURNF "二楼楼梯间"
	CASE 位置_红魔馆_二楼走廊
		RETURNF "二楼走廊"
	CASE 位置_红魔馆_咲夜私室
		RETURNF @"%CALLNAME:人物_咲夜%私室"
	CASE 位置_红魔馆_妖精女仆办公室
		RETURNF "妖精女仆办公室"
	CASE 位置_红魔馆_玩家房间
		RETURNF @"%CALLNAME:MASTER%的房间"
	CASE 位置_红魔馆_蕾米莉亚私室
		RETURNF @"%CALLNAME:人物_蕾米莉亚%私室"
	CASE 位置_红魔馆_地下室
		RETURNF "地下室"
	CASE 位置_红魔馆_大浴场
		RETURNF "大浴室"
	CASE 位置_雾之湖北部
		RETURNF "湖北部"
	CASE 位置_琪露诺的家
		RETURNF @"%CALLNAME:人物_琪露诺%的家"
	CASE 位置_大妖精的家
		RETURNF @"%CALLNAME:人物_大妖精%的家"
	CASE 位置_魔理沙的家
		RETURNF @"%CALLNAME:人物_魔理沙%的家"
	CASE 位置_红魔馆_屋外厕所
		RETURNF "院子厕所"
	CASE 位置_红魔馆_一楼厕所
		RETURNF "1F厕所"
	CASE 位置_红魔馆_二楼厕所
		RETURNF "2F厕所"
	CASE 位置_魔理沙的家
		;RETURNF "魔理沙的家"
		RETURNF @"%CALLNAME:人物_魔理沙%的家"
	CASE 位置_红魔馆_三楼阳台
		RETURNF "3F阳台"
	CASE 位置_雾之湖南部
		RETURNF "湖南部"
	CASE 位置_魔法之森内部
		RETURNF "魔法之森内"
	CASE 位置_露米娅的家
		RETURNF @"%CALLNAME:人物_露米娅%的家处"
	CASE 位置_爱丽丝的家
		RETURNF @"%CALLNAME:人物_爱丽丝%的家"
	CASE 位置_红魔馆_地下室走廊
		RETURNF "地下室走廊"
	CASE 位置_訪問者宅
		RETURNF @"%NTR_NAME(0)%的家"
	CASE 位置_売春宿
		RETURNF "売春宿"
	CASE 位置_薄暗い路地裏
		RETURNF "薄暗い路地裏"
	CASE 位置_里の住処
		RETURNF "里の住処"
	CASE 位置_永琳診療所
		RETURNF "永琳診療所"
	CASE 位置_人間の里
		RETURNF "人間の里"
	CASE 位置_民家
		RETURNF "民家"
	CASE 位置_博麗神社
		RETURNF "博麗神社"
	CASE 位置_博麗神社周辺
		RETURNF "博麗神社周辺"
	CASE 位置_人間の里周辺
		RETURNF "人間の里周辺"
	CASE 位置_紅魔館周辺
		RETURNF "紅魔館周辺"
	CASE 位置_冥界
		RETURNF "冥界"
	CASE 位置_迷いの竹林
		RETURNF "迷いの竹林"
	CASE 位置_無縁塚
		RETURNF "無縁塚"
	CASE 位置_妖怪の山
		RETURNF "妖怪の山"
	CASE 位置_地底界
		RETURNF "地底界"
	CASE 位置_魔界
		RETURNF "魔界"
	CASE 位置_魔法の森
		RETURNF "魔法の森"
ENDSELECT

;-------------------------------------------------
;関数名:NTR_GETPLACENAME
;訪問者の現在位置を返す
;MASTERから見えない位置の場合"あなたの目の届かない場所"を返す
;-------------------------------------------------
@NTR_GETPLACENAME(ARG)
#FUNCTIONS
;訪問者が見える
; IF NTR_CHK_VISIBLE(ARG)
IF IS_NTR_SHOW_ALL() && IS_NTR_SHOW_POS()
	RETURNF GETPLACENAME(ARG)
ELSE
	;訪問者が見えない
	RETURNF @"%CALLNAME:MASTER%看不到的地方"
ENDIF

;-------------------------------------------------
;関数名:IN_ROOM
;部屋の中で特定要素での最低・最高を持つキャラを取得
;-------------------------------------------------
@IN_ROOM(MINORMAX, 場所, 対象変数, 変数番号, 睡眠SKIP)
#FUNCTION
#DIMS MINORMAX		; "MIN" or "MAX"
#DIM 場所			; 場所コード
#DIMS 対象変数		; 対象となる変数の名前
#DIM 変数番号		; 変数の番号
#DIM 睡眠SKIP		; 0:全員が対象　1:睡眠中の住人は対象外
#DIM LOOP_CHR		; ループ変数
#DIM RET_VAL		; 戻り値
#DIM V_CMP			; 比較する値
#DIM N_CNT			; 該当する人数

N_CNT = 0
SELECTCASE 対象変数
	CASE "CFLAG"
		FOR LOOP_CHR, 1, CHARANUM
			SIF CFLAG:LOOP_CHR:現在位置 != 場所
				CONTINUE
			SIF 睡眠SKIP && CFLAG:LOOP_CHR:睡眠
				CONTINUE
			IF N_CNT++ == 0
				V_CMP = CFLAG:LOOP_CHR:変数番号
				RET_VAL = LOOP_CHR
			ELSEIF MINORMAX == "MAX" && V_CMP < CFLAG:LOOP_CHR:変数番号
				V_CMP = CFLAG:LOOP_CHR:変数番号
				RET_VAL = LOOP_CHR
			ELSEIF MINORMAX == "MIN" && V_CMP > CFLAG:LOOP_CHR:変数番号
				V_CMP = CFLAG:LOOP_CHR:変数番号
				RET_VAL = LOOP_CHR
			ELSEIF V_CMP == CFLAG:LOOP_CHR:変数番号 && RAND:2
				V_CMP = CFLAG:LOOP_CHR:変数番号
				RET_VAL = LOOP_CHR
			ENDIF
		NEXT
		RETURNF RET_VAL
	CASE "TCVAR"
		FOR LOOP_CHR, 1, CHARANUM
			SIF CFLAG:LOOP_CHR:現在位置 != 場所
				CONTINUE
			SIF 睡眠SKIP && CFLAG:LOOP_CHR:睡眠
				CONTINUE
			IF N_CNT++ == 0
				V_CMP = TCVAR:LOOP_CHR:変数番号
				RET_VAL = LOOP_CHR
			ELSEIF MINORMAX == "MAX" && V_CMP < TCVAR:LOOP_CHR:変数番号
				V_CMP = TCVAR:LOOP_CHR:変数番号
				RET_VAL = LOOP_CHR
			ELSEIF MINORMAX == "MIN" && V_CMP > TCVAR:LOOP_CHR:変数番号
				V_CMP = TCVAR:LOOP_CHR:変数番号
				RET_VAL = LOOP_CHR
			ELSEIF V_CMP == TCVAR:LOOP_CHR:変数番号 && RAND:2
				V_CMP = TCVAR:LOOP_CHR:変数番号
				RET_VAL = LOOP_CHR
			ENDIF
		NEXT
		RETURNF RET_VAL
	CASE "ABL"
		FOR LOOP_CHR, 1, CHARANUM
			SIF CFLAG:LOOP_CHR:現在位置 != 場所
				CONTINUE
			SIF 睡眠SKIP && CFLAG:LOOP_CHR:睡眠
				CONTINUE
			IF N_CNT++ == 0
				V_CMP = ABL:LOOP_CHR:変数番号
				RET_VAL = LOOP_CHR
			ELSEIF MINORMAX == "MAX" && V_CMP < ABL:LOOP_CHR:変数番号
				V_CMP = ABL:LOOP_CHR:変数番号
				RET_VAL = LOOP_CHR
			ELSEIF MINORMAX == "MIN" && V_CMP > ABL:LOOP_CHR:変数番号
				V_CMP = ABL:LOOP_CHR:変数番号
				RET_VAL = LOOP_CHR
			ELSEIF V_CMP == ABL:LOOP_CHR:変数番号 && RAND:2
				V_CMP = ABL:LOOP_CHR:変数番号
				RET_VAL = LOOP_CHR
			ENDIF
		NEXT
		RETURNF RET_VAL
	CASE "TALENT"
		FOR LOOP_CHR, 1, CHARANUM
			SIF CFLAG:LOOP_CHR:現在位置 != 場所
				CONTINUE
			SIF 睡眠SKIP && CFLAG:LOOP_CHR:睡眠
				CONTINUE
			IF N_CNT++ == 0
				V_CMP = TALENT:LOOP_CHR:変数番号
				RET_VAL = LOOP_CHR
			ELSEIF MINORMAX == "MAX" && V_CMP < TALENT:LOOP_CHR:変数番号
				V_CMP = TALENT:LOOP_CHR:変数番号
				RET_VAL = LOOP_CHR
			ELSEIF MINORMAX == "MIN" && V_CMP > TALENT:LOOP_CHR:変数番号
				V_CMP = TALENT:LOOP_CHR:変数番号
				RET_VAL = LOOP_CHR
			ELSEIF V_CMP == TALENT:LOOP_CHR:変数番号 && RAND:2
				V_CMP = TALENT:LOOP_CHR:変数番号
				RET_VAL = LOOP_CHR
			ENDIF
		NEXT
		RETURNF RET_VAL
ENDSELECT

;部屋にいる人数を求める
;ARG … 対象の部屋
;ARG:1 … 0:MASTERは含めない 1:MASTERも含める
;ARG:2 … 0:訪問者は含めない 1:訪問者も含める
;ARG:3 … 0:魔理沙は含めない 1:魔理沙も含める
@GET_N_IN_ROOM(ARG, ARG:1, ARG:2, ARG:3)
#FUNCTION
LOCAL:1 = 0
;住人
FOR LOCAL, 0, CHARANUM
	IF LOCAL != MASTER
		SIF CFLAG:LOCAL:現在位置 == ARG
			LOCAL:1 ++
	ENDIF
NEXT
;MASTER
SIF ARG:1 && CFLAG:MASTER:現在位置 == ARG
	LOCAL:1 ++
;訪問者
SIF ARG:2 && FLAG:訪問者の現在位置 == ARG
	LOCAL:1 ++
;侵入者（こいし）
SIF ARG:3 && FLAG:侵入者の現在位置 == ARG
	LOCAL:1 ++

RETURNF LOCAL:1


@MAXROOM()
#FUNCTION
RETURNF 場所番号最大値+1

;ベッドがある部屋
@BEDROOM(ARG)
#FUNCTION
SELECTCASE ARG
	CASE 位置_红魔馆_帕秋莉私室,位置_红魔馆_小恶魔私室,位置_红魔馆_守卫小屋,位置_红魔馆_咲夜私室,位置_红魔馆_玩家房间,位置_红魔馆_蕾米莉亚私室,位置_红魔馆_地下室,位置_琪露诺的家,位置_大妖精的家,位置_魔理沙的家,位置_露米娅的家,位置_爱丽丝的家
		RETURNF 1
	CASE 位置_红魔馆_大浴场
		;游戏座垫
		SIF ITEM:20
			RETURNF 1
ENDSELECT
RETURNF 0


;お風呂がある部屋
@BATHROOM(ARG)
#FUNCTION
SELECTCASE ARG
	CASE 位置_红魔馆_大浴场
		RETURNF 1
ENDSELECT
RETURNF 0


;厨房がある部屋
@KITCHEN(ARG)
#FUNCTION
SELECTCASE ARG
	CASE 位置_红魔馆_厨房,位置_琪露诺的家,位置_大妖精的家,位置_魔理沙的家,位置_爱丽丝的家
		RETURNF 1
ENDSELECT
RETURNF 0

;見通しがいい場所
;戻り値2 野外PLAY 1室内
@OPENPLACE(ARG)
#FUNCTION
SELECTCASE ARG
		;庭、正門、湖、テラス
	CASE 位置_红魔馆_正门,位置_红魔馆_后院,位置_雾之湖北部,位置_雾之湖南部,位置_红魔馆_三楼阳台
		RETURNF 2
		;広間,踊り場,廊下
	CASE 位置_红魔馆_大厅,位置_红魔馆_二楼楼梯间,位置_红魔馆_二楼走廊
		RETURNF 1
ENDSELECT
RETURNF 0


;マップ別の場所設定
@MAP_DISTINCTION(ARG)
#FUNCTION
SELECTCASE ARG
	CASE 位置_雾之湖北部, 位置_雾之湖南部, 位置_琪露诺的家, 位置_大妖精的家, 位置_魔理沙的家, 位置_魔法之森内部, 位置_露米娅的家,位置_爱丽丝的家
		RETURNF 1
	CASEELSE
		RETURNF 0
ENDSELECT

