;オプション設定処理
@OPTION
CLEARLINE 10000
PRINTL □选项设置----------------------------------------------------------------------------------------□
PRINTL
PRINTL [0] - 文本设定
PRINTL [1] - 命令过滤器
PRINT [2] - 消耗品自动购入 
PRINTFORML \@ FLAG:1001 ? ON # OFF \@
PRINT [3] - 馆内清洁情报显示 
PRINTFORML \@ FLAG:1002 ? OFF # ON \@
PRINTFORML [10] - NTR选项
PRINTFORML [11] - 补丁选项
PRINTFORML [12] - 初始化角色
;PRINTFORML [13] - 素质是否会变化（建议ON）
PRINTL
PRINTFORML [15] - 穿了下装的情况下不能看到内裤是什么样的（建议ON）：\@ GETBIT(FLAG:雑多設定,1) ?ON#OFF\@
PRINTFORML [16] - 在移动的时候会被住人拜托事情（任务）：\@ GETBIT(FLAG:雑多設定,2) ?ON#OFF\@
PRINTFORML [17] - 不能越过衣服查看里面的污（精液）（建议ON）：\@ GETBIT(FLAG:汚れ非表示設定,0) ?ON#OFF\@
PRINTL
PRINTFORML [20] - 住人之间的交流　地位と立場
PRINTFORML [21] - 住人不再每天都换衣服：\@ GETBIT(FLAG:匂いフェチ,1) ?ON#OFF\@
;PRINTFORML [24] - 催眠补丁（发现BUG请回报）：\@ GETBIT(FLAG:催眠設定,1) ?ON#OFF\@
PRINTFORML [25] - 好感度上升倍率：\@ FLAG:好感度倍率 ?{FLAG:好感度倍率/10}.{FLAG:好感度倍率%10}倍#1倍\@
PRINTFORML [26] - 屈服度上升倍率：\@ FLAG:屈服度倍率 ?{FLAG:屈服度倍率/10}.{FLAG:屈服度倍率%10}倍#1倍\@
PRINTFORML [27] - 房间和住人的气味设定
;PRINTFORML [28] - 催眠深度の上昇倍率設定：\@ FLAG:催眠倍率 ?{FLAG:催眠倍率}倍#1倍\@
PRINTFORML [29] - 簡易調教模式（阻止反発刻印）：\@ GETBIT(FLAG:簡易調教模式,1) ?ON#OFF\@
PRINTFORML [30] - 私处颜色初始化
PRINTFORML [32] - 禁止受精：\@ GETBIT(FLAG:禁止受精,1) ?ON#OFF\@
PRINTFORML [98] - \@ FLAG:AA表示 ? ┬ # %" "%- \@图像显示%"	" * 5%\@ FLAG:AA表示 ? 打开 # 关闭 \@
SIF FLAG:AA表示
	PRINTFORML [99] - └图像显示设置
PRINTL
PRINTL [100]-返回
PRINTL □选项设置----------------------------------------------------------------------------------------□
$INPUT_LOOP
INPUT
SIF RESULT != 100
	CLEARLINE 10000
IF RESULT == 0
	CALL OPTION_TEXT_SETTING
ELSEIF RESULT == 1
	CALL OPTION_COMMAND_FILTER
ELSEIF RESULT == 2
	FLAG:1001 = !FLAG:1001
ELSEIF RESULT == 3
	CALL OPTION_HOUSE_INFO
ELSEIF RESULT == 10
	CALL NTR_OPTION
ELSEIF RESULT == 11
	CALL LUNA_OPTION
ELSEIF RESULT == 12
	CALL CHARA_RESET
	CALL 体詳細設定１
[SKIPSTART]
ELSEIF RESULT == 13
	CALL Ability_OPTION	
[SKIPEND]
ELSEIF RESULT == 15
	CALL 下着不可視コンフィング
ELSEIF RESULT == 16
	CALL 従者イベントコンフィング
ELSEIF RESULT == 17
	CALL 汚れ非表示コンフィグ
ELSEIF RESULT == 20
	CALL INHABITANT_SETTINGS
ELSEIF RESULT == 21
	CALL 匂いフェチコンフィグ
ELSEIF RESULT == 25
	CALL 好感度倍率コンフィグ
ELSEIF RESULT == 26
	CALL 屈服度倍率コンフィグ
ELSEIF RESULT == 27
	CALL 部屋のにおいコンフィグ
ELSEIF RESULT == 29
	CALL 簡易調教模式選項
ELSEIF RESULT == 30
	CALL 私处颜色初始化
ELSEIF RESULT == 32
	CALL 禁止受精選項
ELSEIF RESULT == 98
	FLAG:AA表示 = !FLAG:AA表示
ELSEIF RESULT == 99 && FLAG:AA表示
	CALL OPTION_立绘设置
ELSEIF RESULT == 100
	RETURN 0
ELSE
	GOTO INPUT_LOOP
ENDIF
RESTART

;テキスト関連
@OPTION_TEXT_SETTING
PRINTL テキストの設定をしてください
PRINT 現在の設定：
IF FLAG:情景テキスト設定 == 1 && FLAG:口上テキスト設定 == 2
	PRINTL 【口上テキスト（常に表示）＋情景テキスト】
ELSEIF FLAG:情景テキスト設定 == 1 && FLAG:口上テキスト設定 == -1
	PRINTL 【情景テキストのみ】
ELSEIF FLAG:情景テキスト設定 == 0 && FLAG:口上テキスト設定 == -1
	PRINTL 【テキストを表示しない】
ENDIF
PRINTL 　
PRINTL [0] - 角色台词+情景文本
PRINTL [1] - 仅情景文本
PRINTL [2] - 不显示文本
PRINTL [3] - 口上颜色
PRINTL [100]-返回
$INPUT_LOOP
INPUT
IF RESULT == 100
	RETURN 0
ELSEIF RESULT == 0
	PRINTL 【口上テキスト＋情景テキスト】に設定しました
	FLAG:情景テキスト設定 = 1
	FLAG:口上テキスト設定 = 2
ELSEIF RESULT == 1
	PRINTL 【情景テキストのみ】に設定しました
	FLAG:情景テキスト設定 = 1
	FLAG:口上テキスト設定 = -1
ELSEIF RESULT == 2
	PRINTL 【テキストを表示しない】に設定しました
	FLAG:情景テキスト設定 = 0
	FLAG:口上テキスト設定 = -1
ELSEIF RESULT == 3
	FLAG:口上颜色 = !FLAG:口上颜色
	PRINTFORMW 当前口上颜色为[\@FLAG:口上颜色 ? 开 # 关\@]
ELSE
	GOTO INPUT_LOOP
ENDIF

RESTART

;文字列変数に保存してみた
@OPTION_COMMAND_FILTER
VARSET LOCAL
FOR COUNT,0,650
	LOCALS = /{COUNT}/
	SIF STRCOUNT(SAVESTR:0,LOCALS)
		LOCAL:COUNT = 1
NEXT
SIF SAVESTR:0 == ""
	SAVESTR:0 = /
DRAWLINE
TFLAG:100 = 1
FOR COUNT,0,650
	LOCALS = /{COUNT}/
	SIF STRCOUNT(SAVESTR:0,LOCALS)
		SETCOLOR 色設定_テキスト_備考
	SIF STRLENS(TRAINNAME:COUNT)
		PRINTFORMC %TRAINNAME:COUNT%[{COUNT,3}]
	RESETCOLOR
NEXT
TFLAG:100 = 0
PRINTL 
DRAWLINE
PRINTL [1000] - 決定 [1001] - リセット
PRINTL [1002] - コマンドフィルタの保存 [1003] - コマンドフィルタのロード
PRINTL [1010] - SMフィルタ [1011] - Ｖフィルタ
INPUT
IF RESULT == 1000
	RETURN 0
ELSEIF RESULT == 1001
	SAVESTR:0 = 
	RESTART
ELSEIF RESULT == 1002
	$INPUT_LOOP_SAVE
	LOADGLOBAL
	FOR LOCAL,0,3
		PRINTFORM [{LOCAL}] - 
		IF STRLENS(GLOBALS:(LOCAL * 2 + 1))
			PRINTFORML [%GLOBALS:(LOCAL * 2 + 1)%]
		ELSE
			PRINTL ----------
		ENDIF
	NEXT
	PRINTL [100] - 返回
	INPUT
	LOCAL = RESULT
	IF RESULT == 100
		RESTART
	ELSEIF RESULT < 0 || RESULT > 2
		GOTO INPUT_LOOP_SAVE
	ENDIF
	SIF STRLENS(GLOBALS:(RESULT * 2 + 1))
		PRINTFORML 【%GLOBALS:(RESULT * 2 + 1)%】 このデータに上書きします
	PRINTL コマンドフィルタの名前を登録してください
	INPUTS
	GLOBALS:(LOCAL * 2 + 1) = %RESULTS%
	GLOBALS:(LOCAL * 2) = %SAVESTR:0%
	PRINTFORMW コマンドフィルタ【%GLOBALS:(LOCAL * 2 + 1)%】を登録しました
	SAVEGLOBAL
	RESTART
ELSEIF RESULT == 1003
	$INPUT_LOOP_LOAD
	LOADGLOBAL
	FOR LOCAL,0,3
		PRINTFORM [{LOCAL}] - 
		IF STRLENS(GLOBALS:(LOCAL * 2 + 1))
			PRINTFORML [%GLOBALS:(LOCAL * 2 + 1)%]
		ELSE
			PRINTL ----------
		ENDIF
	NEXT
	PRINTL [100] - 返回
	INPUT
	IF RESULT == 100
		RESTART
	ELSEIF RESULT < 0 || RESULT > 2
		GOTO INPUT_LOOP_LOAD
	ENDIF
	PRINTFORMW コマンドフィルタ【%GLOBALS:(RESULT * 2 + 1)%】を読み込みました
	SAVESTR:0 = %GLOBALS:(RESULT * 2)%
	RESTART
	;各種フィルタ
ELSEIF RESULT == 1010 || RESULT == 1011
	FOR COUNT,0,650
		;SM
		IF RESULT == 1010
			SIF (COUNT >= 100 && COUNT < 120) || (COUNT >= 140 && COUNT < 160)
				LOCAL:COUNT = 1
			;V
		ELSEIF RESULT == 1011
			SIF COUNT == 3 || COUNT == 44 || COUNT == 60 || COUNT == 61 || COUNT == 65 || COUNT == 67 || COUNT == 68 || COUNT == 71 
				LOCAL:COUNT = 1
			SIF COUNT == 122|| COUNT == 141 || COUNT == 143 || COUNT == 185 || COUNT == 603 || COUNT == 644
				LOCAL:COUNT = 1
		ENDIF
	NEXT
ELSEIF STRLENS(TRAINNAME:RESULT)
	LOCAL:RESULT = !LOCAL:RESULT
ELSE
	RESTART
ENDIF
SAVESTR:0 = /
FOR COUNT,0,650
	SIF !LOCAL:COUNT
		CONTINUE
	LOCALS = /{COUNT}/
	SIF !STRCOUNT(SAVESTR:0,LOCALS)
		SAVESTR:0 = %SAVESTR:0%{COUNT}/
NEXT
RESTART

@OPTION_HOUSE_INFO
PRINTL 可以看到垃圾之山？
PRINTL [0] 情報表示ON [1] - OFF
INPUT
IF RESULT == 0
	FLAG:1002 = 0
ELSE
	FLAG:1002 = 1
ENDIF

[SKIPSTART]
@Ability_OPTION
PRINTL 根据经验改变素质？
PRINTL [0] 是的 [1] 不要
INPUT
IF RESULT == 0
	FLAG:素質変動onoff = 1
	PRINTL 素质会变化
ELSE
	FLAG:素質変動onoff = 0
	PRINTL 素质不会变化
ENDIF
[SKIPEND]
@下着不可視コンフィング
IF GETBIT(FLAG:雑多設定,1)
	CLEARBIT FLAG:雑多設定,1
ELSE
	SETBIT FLAG:雑多設定,1
ENDIF

@従者イベントコンフィング
IF GETBIT(FLAG:雑多設定,2)
	CLEARBIT FLAG:雑多設定,2
ELSE
	SETBIT FLAG:雑多設定,2
ENDIF


@汚れ非表示コンフィグ
IF GETBIT(FLAG:汚れ非表示設定,0)
	CLEARBIT FLAG:汚れ非表示設定,0
ELSE
	SETBIT FLAG:汚れ非表示設定,0
ENDIF

@匂いフェチコンフィグ
IF GETBIT(FLAG:匂いフェチ,1)
	CLEARBIT FLAG:匂いフェチ,1
ELSE
	SETBIT FLAG:匂いフェチ,1
ENDIF
[SKIPSTART]
@催眠パッチコンフィグ
IF GETBIT(FLAG:催眠設定,1)
	CLEARBIT FLAG:催眠設定,1
ELSE
	SETBIT FLAG:催眠設定,1
ENDIF
[SKIPEND]
@好感度倍率コンフィグ
PRINTL
PRINTFORML 倍率設定（1で0.1倍　MAX 50　0以下でリセット）
INPUT

IF RESULT > 0
	FLAG:好感度倍率 = MIN(RESULT, 50)
ELSE
	FLAG:好感度倍率 = 0
ENDIF

@屈服度倍率コンフィグ
PRINTL
PRINTFORML 倍率設定（MAX 500　0未満でリセット）
INPUT

IF RESULT > 0
	FLAG:屈服度倍率 = MIN(RESULT, 500)
ELSE
	FLAG:屈服度倍率 = 0
ENDIF
[SKIPSTART]
@催眠倍率コンフィグ	
PRINTL
PRINTFORML 倍率設定（MAX 50　0以下會自動復原）
INPUT

IF RESULT > 0
	FLAG:催眠倍率 = MIN(RESULT, 50)
ELSE
	FLAG:催眠倍率 = 0
ENDIF	
[SKIPEND]
@部屋のにおいコンフィグ
$CONFIG_TOP
PRINT 現在の状態は 
IF GETBIT(FLAG:部屋のにおい_初期FLAG,0) && GETBIT(FLAG:部屋のにおい_初期FLAG,1)
	PRINT 詳細モード
ELSEIF GETBIT(FLAG:部屋のにおい_初期FLAG,0)
	PRINT 通常モード
ELSE
	PRINT OFF
ENDIF
PRINTL です
PRINTL
PRINTL [100] - 通常模式：只有身体的气味和汗的味道能够辨别
PRINTL [101] - 详细模式：所有气味都能详细辨别
PRINTL [102] -   OFF   ：不能使用此功能
PRINTL
PRINTL [999] 返回

$INPUT_LOOP
INPUT
IF RESULT == 100
	SETBIT FLAG:部屋のにおい_初期FLAG,0
	CLEARBIT FLAG:部屋のにおい_初期FLAG,1
ELSEIF RESULT == 101
	SETBIT FLAG:部屋のにおい_初期FLAG,0
	SETBIT FLAG:部屋のにおい_初期FLAG,1
ELSEIF RESULT == 102
	CLEARBIT FLAG:部屋のにおい_初期FLAG,0
	CLEARBIT FLAG:部屋のにおい_初期FLAG,1
ELSEIF RESULT == 999
	RETURN 0
ELSE
	GOTO INPUT_LOOP
ENDIF
GOTO CONFIG_TOP

@簡易調教模式選項
IF GETBIT(FLAG:簡易調教模式,1)
	CLEARBIT FLAG:簡易調教模式,1
ELSE
	SETBIT FLAG:簡易調教模式,1
ENDIF

@私处颜色初始化
FOR LOCAL,1,開始時人数
	BASE:LOCAL:乳头色素 = 0
	BASE:LOCAL:小穴色素 = 0
	BASE:LOCAL:肛门色素 = 0
NEXT

@禁止受精選項
IF GETBIT(FLAG:禁止受精,1)
	CLEARBIT FLAG:禁止受精,1
ELSE
	SETBIT FLAG:禁止受精,1
ENDIF

@OPTION_立绘设置
PRINTL
PRINTFORML [*]┬ 一行同时显示{FLAG:画像表示}个\@ FLAG:图像_立绘类型 ? 颜绘 # 立绘 \@
PRINTFORML [1]├ 增加
PRINTFORML [2]└ 减少
PRINTFORML [3] - 角色图像类型 \@ FLAG:图像_立绘类型 ? [颜绘] # [立绘] \@
PRINTFORML [4]\@ FLAG:图像_插图显示 ? ┬ # %" "%- \@ 动画 \@ FLAG:图像_插图显示 ? 打开 # 关闭 \@
IF FLAG:图像_插图显示
	PRINT [5]└ 射精动画
	SELECTCASE FLAG:图像_射精图像类型
		CASE 0
			PRINTL  [动画＋声音]
		CASE 1
			PRINTL  [仅动画]
		CASE 2
			PRINTL  [仅声音]
	ENDSELECT
ENDIF
PRINTFORML [6] - 动画重复 \@ FLAG:图像_动画 ? {FLAG:图像_动画} 次 # 关闭 \@
PRINTFORML [7] - 排列方式设置：\@ FLAG:图像_立绘类型 ? 颜绘 # 立绘 \@ [\@ FLAG:画像表示位置 ? 左侧# 居中 \@]显示
PRINTFORML [8] - 显示头像框 \@ FLAG:图像_图像框显示 ? 显示 # 关闭 \@
PRINTFORML [999] - 返回
INPUT
IF RESULT == 999
	RETURN 0
ELSEIF RESULT == 1
	FLAG:画像表示++
	SIF FLAG:画像表示 > 10
		FLAG:画像表示 = 10
ELSEIF RESULT == 2
	FLAG:画像表示--
	SIF FLAG:画像表示 < 1
		FLAG:画像表示 = 1
ELSEIF RESULT == 3
	FLAG:图像_立绘类型 = !FLAG:图像_立绘类型
ELSEIF RESULT == 4
	FLAG:图像_插图显示 = !FLAG:图像_插图显示
ELSEIF RESULT == 5 && FLAG:图像_插图显示
	FLAG:图像_射精图像类型++
	SIF FLAG:图像_射精图像类型 >= 3
		FLAG:图像_射精图像类型 = 0
ELSEIF RESULT == 6
	FLAG:图像_动画++
	SIF FLAG:图像_动画 >= 6
		FLAG:图像_动画 = 0
ELSEIF RESULT == 7
	FLAG:画像表示位置 = !FLAG:画像表示位置
ELSEIF RESULT == 8
	FLAG:图像_图像框显示 = !FLAG:图像_图像框显示
ENDIF
RESTART