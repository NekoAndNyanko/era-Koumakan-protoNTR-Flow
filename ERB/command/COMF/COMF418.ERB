;-------------------------------------------------
;购买钥匙
;-------------------------------------------------
;公众便所になった住人の贞操帯の购买钥匙コマンド
;
;
;-------------------------------------------------
@COM418
;購入対象選択
#DIM 奴隷
#DIM 鍵基本価格
#DIM 鍵特別価格
#DIM 父親


SELECTCASE EXP:MASTER:买春经验
	CASE 0
		PRINTFORML %NTR_NAME(0)%拿出了一个小钥匙，说%CALLNAME:MASTER%也要用『便所』来做吗？然后笑了笑。
	CASEELSE
		PRINTFORML %CALLNAME:MASTER%在请求钥匙的时候，%NTR_NAME(0)%笑了笑，说着你好像很喜欢我家的『便所』之类的话。
ENDSELECT

FOR 奴隷,1,CHARANUM
	IF TALENT:奴隷:公众便所
		鍵基本価格 = NTR_COST_UNLOCK(奴隷)
		鍵特別価格 = NTR_COST_UNLOCK_SP(奴隷,鍵基本価格)
		SELECTCASE 鍵基本価格
			CASE IS >= 4000
				PRINTFORML %"["+TOSTR(奴隷,"000")+"]-高級便所『"+CALLNAME:奴隷+"』(4時間、$" + TOSTR(鍵特別価格) + ")"%
			CASE IS >= 2000
				PRINTFORML %"["+TOSTR(奴隷,"000")+"]-中級便所『"+CALLNAME:奴隷+"』(4時間、$" + TOSTR(鍵特別価格) + ")"%
			CASE IS >= 1000
				PRINTFORML %"["+TOSTR(奴隷,"000")+"]-低級便所『"+CALLNAME:奴隷+"』(4時間、$" + TOSTR(鍵特別価格) + ")"%
			CASEELSE
				PRINTFORML %"["+TOSTR(奴隷,"000")+"]-廉价便所『"+CALLNAME:奴隷+"』(4時間、$" + TOSTR(鍵特別価格) + ")"%
		ENDSELECT
	ENDIF
NEXT
PRINTFORML [999] - やっぱり放弃
$INPUT_LOOP
INPUT
SIF 999 == RESULT
	RETURN 1
SIF RESULT <= 0 || CHARANUM <= RESULT
	GOTO INPUT_LOOP
SIF !TALENT:RESULT:公众便所
	GOTO INPUT_LOOP
奴隷 = RESULT
;購入金額
鍵基本価格 = NTR_COST_UNLOCK(奴隷)
鍵特別価格 = NTR_COST_UNLOCK_SP(奴隷,鍵基本価格)
IF 鍵基本価格 < 鍵特別価格
	PRINTFORML %"当"+CALLNAME:MASTER+"尝试购买钥匙时，" + NTR_NAME(0) + "忽然想起"+CALLNAME:奴隷+"是"+CALLNAME:MASTER+"的"+MSG_RE_LOVER(奴隷)+"、"%
	PRINTFORML %"决定以『特价』进行钥匙的贩卖。"%
	SELECTCASE 鍵基本価格
		CASE IS >= 4000
			PRINTFORML %"高級便所『"+CALLNAME:奴隷+"』(4時間、通常価格 $" + TOSTR(鍵基本価格) + " → 特別価格 $" + TOSTR(鍵特別価格) + ")"%
		CASE IS >= 2000
			PRINTFORML %"中級便所『"+CALLNAME:奴隷+"』(4時間、通常価格 $" + TOSTR(鍵基本価格) + " → 特別価格 $" + TOSTR(鍵特別価格) + ")"%
		CASE IS >= 1000
			PRINTFORML %"低級便所『"+CALLNAME:奴隷+"』(4時間、通常価格 $" + TOSTR(鍵基本価格) + " → 特別価格 $" + TOSTR(鍵特別価格) + ")"%
		CASEELSE
			PRINTFORML %"廉价便所『"+CALLNAME:奴隷+"』(4時間、通常価格 $" + TOSTR(鍵基本価格) + " → 特別価格 $" + TOSTR(鍵特別価格) + ")"%
	ENDSELECT

	$INPUT_LOOP_SP
	PRINTFORML %"[1] - 用『特价』购买"%
	PRINTFORML %"[2] - 抱怨『特价』"%
	PRINTFORML %"[0] - 放弃购买钥匙"%
	INPUT
	IF 2 == RESULT
		CALL COM418_Estimates(奴隷)
		GOTO INPUT_LOOP_SP
	ELSEIF 1 == RESULT
		;なにもなし
	ELSEIF 0 == RESULT
		PRINTFORML %CALLNAME:MASTER + "放弃了购买钥匙、"+NTR_NAME(0) + "表示无所谓、把『" + CALLNAME:奴隷 + "』卖给别人当肉便器也一样，于是带着"+ CALLNAME:奴隷 + "去了别的地方……。"%
		CALL GoOut_SeeYou_900(奴隷,1)
		RETURN 1
	ELSE
		GOTO INPUT_LOOP_SP
	ENDIF
ENDIF
IF MONEY < 鍵特別価格
	PRINTFORMW 钱不够。
	GOTO INPUT_LOOP
ENDIF
;商品の説明

IF TALENT:奴隷:浮気公認
	PRINTFORML %"打算支付『便所』的购买金时、" + NTR_NAME(0) + "面带嘲笑、询问是想确认被其他人的阴茎反复抽插过的"+MSG_RE_LOVER(奴隷)+"的具体情况嘛？"%
ENDIF

IF TALENT:奴隷:妊娠
	; 妊娠している場合は半額
	PRINTFORML %NTR_NAME(0)+"把钥匙交出来了，还说『"+CALLNAME:奴隷+"』已经妊娠了，所以就便宜一点。"%
	父親 = CFLAG:奴隷:にんっしんっ -1
	; 奴隷が恋慕住人で、父親がMASTERでない時。1/3の確率で表示。
	IF TALENT:奴隷:恋慕 && 父親 != MASTER && 0 == RAND:3
		PRINTFORML %NTR_NAME(0)+"回想起"+CALLNAME:奴隷+"是"+CALLNAME:MASTER+"的"+MSG_RE_LOVER(奴隷)+"，那么自己的"+MSG_RE_LOVER(奴隷)+"怀上别人的孩子是什么心情？然后露出讨厌的笑容。"%
	ELSE
		PRINTFORML %"他还补充说，对孕妇还是不要太过于粗暴了。"%
	ENDIF
ELSEIF TALENT:奴隷:危险日
	; 妊娠していなくて危险日の場合は5割増
	PRINTFORML %NTR_NAME(0)+"交出了钥匙，然后说『"+CALLNAME:奴隷+"』现在是危险日，所以价格会更高一些。"%
	IF TALENT:奴隷:恋慕
		PRINTFORML %NTR_NAME(0)+"突然想起"+CALLNAME:奴隷+"是"+CALLNAME:MASTER+"的"+MSG_RE_LOVER(奴隷)+"，用金钱购买"+MSG_RE_LOVER(奴隷)+"的身体是什么样的心情呢？然后露出讨厌的笑容。"%
	ENDIF
ELSEIF TALENT:奴隷:恋慕
	IF BASE:奴隷:Ｖ松弛度 > 700 || BASE:奴隷:Ａ松弛度 > 700
		IF BASE:奴隷:Ｖ松弛度 > 700 && BASE:奴隷:Ａ松弛度 > 700
			PRINTFORML %NTR_NAME(0)+"交来了钥匙，然后说『"+CALLNAME:奴隷+"』前后两个小穴都很松了，所以用嘴会更好一点。"%
		ELSEIF BASE:奴隷:Ａ松弛度 > 700
			PRINTFORML %NTR_NAME(0)+"交来了钥匙，然后说『"+CALLNAME:奴隷+"』的菊穴会很松，用膣道会比较好。"%
		ELSEIF BASE:奴隷:Ｖ松弛度 > 700
			PRINTFORML %NTR_NAME(0)+"交来了钥匙，然后说『"+CALLNAME:奴隷+"』的膣道已经很松了，用菊穴会更好些。"%
		ENDIF
		PRINTFORML %CALLNAME:MASTER+"露出了微妙的表情，随后"+NTR_NAME(0)+"说『"+CALLNAME:奴隷+"』是"+CALLNAME:MASTER+"的"+MSG_RE_LOVER(奴隷)+"不管用什么养的洞都会很享受的的，然后露出了令人厌恶的笑容。"%
	ELSE
		PRINTFORML %NTR_NAME(0)+"突然想起"+CALLNAME:奴隷+"是"+CALLNAME:MASTER+"的"+MSG_RE_LOVER(奴隷)+"，用金钱购买"+MSG_RE_LOVER(奴隷)+"的身体是什么样的心情呢？然后露出讨厌的笑容。"%
	ENDIF
ELSE
	IF BASE:奴隷:Ｖ松弛度 > 700 && BASE:奴隷:Ａ松弛度 > 700
		PRINTFORML %NTR_NAME(0)+"交来了钥匙，然后说『"+CALLNAME:奴隷+"』前后两个小穴都很松了，所以用嘴会更好一点。"%
	ELSEIF BASE:奴隷:Ａ松弛度 > 700
		PRINTFORML %NTR_NAME(0)+"交来了钥匙，然后说『"+CALLNAME:奴隷+"』的菊穴会很松，用膣道会比较好。"%
	ELSEIF BASE:奴隷:Ｖ松弛度 > 700
		PRINTFORML %NTR_NAME(0)+"交来了钥匙，然后说『"+CALLNAME:奴隷+"』的膣道已经很松了，用菊穴会更好些。"%
	ENDIF
ENDIF

PRINTFORMW %"……买到了公众便所『"+CALLNAME:奴隷+"』的贞操带钥匙。"%

EXP:MASTER:买春经验++
MONEY -= 鍵特別価格
;鍵購入
FLAG:贞操帯鍵購入フラグ = 奴隷
CFLAG:奴隷:NTR鍵購入回数++
;鍵購入カウンタ
FLAG:贞操帯鍵有効カウンタ = TIME_PROGRESS() + 4*60
;住人の反応等
FOR 奴隷,1,CHARANUM
	;鍵購入反応フラグ初期化
	CFLAG:奴隷:NTR贞操帯反応 = 1
NEXT

RETURN 1

@COM418_Estimates(奴隷)
#DIM 奴隷
PRINTFORML %"质问了为什么针对自己的所谓『特价』那么昂贵、"%
IF TALENT:奴隷:人妻 || TALENT:奴隷:恋慕
	IF TALENT:奴隷:浮気公認
		PRINTFORML %NTR_NAME(0)+ "反驳" + CALLNAME:MASTER + "不是已经认同了" + CALLNAME:奴隷 + "的出轨了吗？"%
		PRINTFORML %"那么给会因为自己的" +MSG_RE_LOVER(奴隷) + "被其他人的阴茎插入而兴奋起来的变态一个专属的『特价』、不是很合理吗。"%
	ELSE
		PRINTFORML %NTR_NAME(0)+ "笑着说当然是因为" + CALLNAME:奴隷 + "是" + CALLNAME:MASTER + "的" + MSG_RE_LOVER(奴隷) + "、"%
		PRINTFORML %"如果觉得" + MSG_RE_LOVER(奴隷) + "在别的人的阴茎下娇喘也没问题的话、不买也可以啊。"%
	ENDIF
ELSE
	PRINTFORML %CALLNAME:MASTER + "干扰了我们的正常营业、所以价格上涨了。"%
ENDIF
RETURN 1

